(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{J6bJ:function(t,e,i){"use strict";i.r(e),i.d(e,"CrmModule",(function(){return Ne}));var s=i("tyNb"),o=i("LvDl"),r=i("ey9i"),n=i("fXoL"),a=i("oARB"),c=i("ofXK"),b=i("eO1q"),u=i("3Pt+"),d=i("rEr+"),l=i("7zfz"),m=i("Mfq2");const p=["dataTable"];function h(t,e){if(1&t){const t=n.Wb();n.Vb(0,"button",20),n.dc("click",(function(){return n.Dc(t),n.hc(2).downloadAsExcel()})),n.Qb(1,"i",21),n.Vb(2,"span"),n.Lc(3,"Download as Excel"),n.Ub(),n.Ub()}}function g(t,e){if(1&t&&(n.Vb(0,"div",22),n.Vb(1,"div",23),n.Vb(2,"div",24),n.Lc(3),n.Ub(),n.Vb(4,"div",25),n.Lc(5),n.Ub(),n.Ub(),n.Ub()),2&t){const t=e.$implicit,i=n.hc(2);n.Cb(3),n.Nc(" ",t.name," "),n.Cb(1),n.oc("ngClass",i.appConstants.ACTIVITY_STATUS_COLOR_CLS[t.id]),n.Cb(1),n.Mc(t.count)}}function y(t,e){1&t&&(n.Vb(0,"th",43),n.Lc(1,"Branch Name "),n.Qb(2,"p-sortIcon",30),n.Ub()),2&t&&(n.oc("pSortableColumn","branchName"),n.Cb(2),n.oc("field","branchName"))}function f(t,e){1&t&&(n.Vb(0,"th",44),n.Lc(1,"Sap Doc No"),n.Qb(2,"p-sortIcon",30),n.Ub()),2&t&&(n.oc("pSortableColumn","sapId"),n.Cb(2),n.oc("field","sapId"))}function v(t,e){if(1&t){const t=n.Wb();n.Vb(0,"th"),n.Vb(1,"input",41),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(3).searchForm.branchName=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(3).resetListing()})),n.Ub(),n.Ub()}if(2&t){const t=n.hc(3);n.Cb(1),n.oc("ngModel",t.searchForm.branchName)}}function L(t,e){if(1&t){const t=n.Wb();n.Vb(0,"th"),n.Vb(1,"input",41),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(3).searchForm.sapId=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(3).resetListing()})),n.Ub(),n.Ub()}if(2&t){const t=n.hc(3);n.Cb(1),n.oc("ngModel",t.searchForm.sapId)}}function C(t,e){if(1&t&&(n.Vb(0,"option",45),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Mc(t.name)}}function S(t,e){if(1&t&&(n.Vb(0,"option",45),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Mc(t.activityName)}}function I(t,e){if(1&t&&(n.Vb(0,"option",45),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Nc(" ",t.name," ")}}function U(t,e){if(1&t){const t=n.Wb();n.Vb(0,"tr"),n.Vb(1,"th",26),n.Lc(2,"Actions"),n.Ub(),n.Jc(3,y,3,2,"th",27),n.Jc(4,f,3,2,"th",28),n.Vb(5,"th",29),n.Lc(6,"Overdue "),n.Qb(7,"p-sortIcon",30),n.Ub(),n.Vb(8,"th",31),n.Lc(9,"Priority "),n.Qb(10,"p-sortIcon",30),n.Ub(),n.Vb(11,"th",29),n.Lc(12,"Activity No "),n.Qb(13,"p-sortIcon",30),n.Ub(),n.Vb(14,"th",29),n.Lc(15,"Activity Type "),n.Qb(16,"p-sortIcon",30),n.Ub(),n.Vb(17,"th",32),n.Lc(18,"Assigned To "),n.Qb(19,"p-sortIcon",30),n.Ub(),n.Vb(20,"th",29),n.Lc(21,"Status "),n.Qb(22,"p-sortIcon",30),n.Ub(),n.Vb(23,"th",33),n.Lc(24,"Start Time "),n.Qb(25,"p-sortIcon",30),n.Ub(),n.Vb(26,"th",32),n.Lc(27,"Business Partner Name "),n.Qb(28,"p-sortIcon",30),n.Ub(),n.Vb(29,"th",34),n.Lc(30,"Distribution Rules"),n.Ub(),n.Ub(),n.Vb(31,"tr",35),n.Vb(32,"th"),n.Vb(33,"a",36),n.dc("click",(function(){return n.Dc(t),n.hc(2).clearSearchForm()})),n.Qb(34,"i",37),n.Lc(35,"Clear"),n.Ub(),n.Ub(),n.Jc(36,v,2,1,"th",0),n.Jc(37,L,2,1,"th",0),n.Qb(38,"th"),n.Vb(39,"th"),n.Vb(40,"select",38),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.priorityId=e}))("change",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Vb(41,"option",39),n.Lc(42,"--SELECT--"),n.Ub(),n.Jc(43,C,2,2,"option",40),n.Ub(),n.Ub(),n.Vb(44,"th"),n.Vb(45,"input",41),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.activityNo=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Ub(),n.Ub(),n.Vb(46,"th"),n.Vb(47,"select",42),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.activityTypeId=e}))("change",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Vb(48,"option",39),n.Lc(49,"--SELECT--"),n.Ub(),n.Jc(50,S,2,2,"option",40),n.Ub(),n.Ub(),n.Vb(51,"th"),n.Vb(52,"input",41),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.assignedToName=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Ub(),n.Ub(),n.Vb(53,"th"),n.Vb(54,"select",42),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.status=e}))("change",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Vb(55,"option",39),n.Lc(56,"--SELECT--"),n.Ub(),n.Jc(57,I,2,2,"option",40),n.Ub(),n.Ub(),n.Vb(58,"th"),n.Vb(59,"p-calendar",12),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.startDateTime=e}))("onSelect",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Ub(),n.Ub(),n.Vb(60,"th"),n.Vb(61,"input",41),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.partnerName=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Ub(),n.Ub(),n.Qb(62,"th"),n.Ub()}if(2&t){const t=n.hc(2);n.Cb(3),n.oc("ngIf",!t.storageService.get("isSingleBranchUser")),n.Cb(1),n.oc("ngIf",t.storageService.get("isSap")),n.Cb(1),n.oc("pSortableColumn","overDueValue"),n.Cb(2),n.oc("field","overDueValue"),n.Cb(1),n.oc("pSortableColumn","priorityId"),n.Cb(2),n.oc("field","priorityId"),n.Cb(1),n.oc("pSortableColumn","activityNo"),n.Cb(2),n.oc("field","activityNo"),n.Cb(1),n.oc("pSortableColumn","activityTypeId"),n.Cb(2),n.oc("field","activityTypeId"),n.Cb(1),n.oc("pSortableColumn","assignedToName"),n.Cb(2),n.oc("field","assignedToName"),n.Cb(1),n.oc("pSortableColumn","status"),n.Cb(2),n.oc("field","status"),n.Cb(1),n.oc("pSortableColumn","startDateTime"),n.Cb(2),n.oc("field","startDateTime"),n.Cb(1),n.oc("pSortableColumn","partnerName"),n.Cb(2),n.oc("field","partnerName"),n.Cb(8),n.oc("ngIf",!t.storageService.get("isSingleBranchUser")),n.Cb(1),n.oc("ngIf",t.storageService.get("isSap")),n.Cb(3),n.oc("ngModel",t.searchForm.priorityId),n.Cb(3),n.oc("ngForOf",t.priorityList),n.Cb(2),n.oc("ngModel",t.searchForm.activityNo),n.Cb(2),n.oc("ngModel",t.searchForm.activityTypeId),n.Cb(3),n.oc("ngForOf",t.activityTypeList),n.Cb(2),n.oc("ngModel",t.searchForm.assignedToName),n.Cb(2),n.oc("ngModel",t.searchForm.status),n.Cb(3),n.oc("ngForOf",t.statusList),n.Cb(2),n.oc("ngModel",t.searchForm.startDateTime)("monthNavigator",!0)("yearNavigator",!0)("yearRange",t.appConstants.PICKER_YEAR_RANGE)("dateFormat",t.appConstants.PICKER_DATE_FORMAT),n.Cb(2),n.oc("ngModel",t.searchForm.partnerName)}}function V(t,e){if(1&t&&(n.Vb(0,"td"),n.Lc(1),n.Ub()),2&t){const t=n.hc().$implicit;n.Cb(1),n.Mc(t.branchName)}}function D(t,e){if(1&t&&(n.Vb(0,"td"),n.Lc(1),n.Ub()),2&t){const t=n.hc().$implicit;n.Cb(1),n.Mc(t.sapId)}}function F(t,e){if(1&t&&(n.Vb(0,"span",52),n.Lc(1),n.Ub()),2&t){const t=n.hc().$implicit;n.Cb(1),n.Nc("",t.overDueValue," Days")}}function N(t,e){if(1&t&&(n.Vb(0,"tr"),n.Vb(1,"td"),n.Vb(2,"a",46),n.Qb(3,"i",47),n.Ub(),n.Ub(),n.Jc(4,V,2,1,"td",0),n.Jc(5,D,2,1,"td",0),n.Vb(6,"td"),n.Jc(7,F,2,1,"span",48),n.Ub(),n.Vb(8,"td"),n.Vb(9,"span",49),n.Lc(10),n.Ub(),n.Ub(),n.Vb(11,"td"),n.Lc(12),n.Ub(),n.Vb(13,"td"),n.Lc(14),n.Ub(),n.Vb(15,"td"),n.Qb(16,"img",50),n.Lc(17),n.Ub(),n.Vb(18,"td"),n.Vb(19,"span",49),n.Lc(20),n.Ub(),n.Ub(),n.Vb(21,"td"),n.Lc(22),n.Ub(),n.Vb(23,"td"),n.Lc(24),n.Ub(),n.Vb(25,"td"),n.Vb(26,"div",51),n.Lc(27),n.Ub(),n.Ub(),n.Ub()),2&t){const t=e.$implicit,i=n.hc(2);n.Cb(2),n.qc("routerLink","/branch/crm/activity-edit/",i.utilsService.encrypt(t.id),""),n.Cb(2),n.oc("ngIf",!i.storageService.get("isSingleBranchUser")),n.Cb(1),n.oc("ngIf",i.storageService.get("isSap")),n.Cb(2),n.oc("ngIf",t.overDueValue<0),n.Cb(2),n.oc("ngClass",i.appConstants.PRIORITY_STATUS_COLOR_CLS[t.priorityId]),n.Cb(1),n.Mc(t.priorityName),n.Cb(2),n.Mc(t.activityNo),n.Cb(2),n.Mc(t.activityName),n.Cb(2),n.oc("src",t.assignedToImgUrl?t.assignedToImgUrl:i.appConstants.DEFAULT_USER_ICON,n.Fc),n.Cb(1),n.Oc("\xa0",t.assignedToCode," - ",t.assignedToName,""),n.Cb(2),n.oc("ngClass",i.appConstants.ACTIVITY_STATUS_COLOR_CLS[t.status]),n.Cb(1),n.Mc(t.statusName),n.Cb(2),n.Mc(t.startDateTime),n.Cb(2),n.Oc("",t.partnerCode," - ",t.partnerName,""),n.Cb(2),n.oc("tooltip",t.distributionRulesValues),n.Cb(1),n.Nc(" ",t.distributionRulesValues,"")}}function T(t,e){if(1&t){const t=n.Wb();n.Tb(0),n.Vb(1,"div",1),n.Vb(2,"span"),n.Lc(3,"A"),n.Ub(),n.Lc(4,"ctivity - List "),n.Vb(5,"div",2),n.Jc(6,h,4,0,"button",3),n.Vb(7,"button",4),n.Qb(8,"i",5),n.Vb(9,"span"),n.Lc(10,"Add Activity"),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(11,"div",6),n.Vb(12,"div",7),n.Vb(13,"div",8),n.Jc(14,g,6,3,"div",9),n.Ub(),n.Ub(),n.Vb(15,"div",8),n.Vb(16,"div",10),n.Vb(17,"label",11),n.Vb(18,"strong"),n.Lc(19,"From Date"),n.Ub(),n.Ub(),n.Vb(20,"p-calendar",12),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc().searchForm.fromDate=e}))("onSelect",(function(){return n.Dc(t),n.hc().resetListing()})),n.Ub(),n.Ub(),n.Vb(21,"div",10),n.Vb(22,"label",11),n.Vb(23,"strong"),n.Lc(24,"To Date"),n.Ub(),n.Ub(),n.Vb(25,"p-calendar",13),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc().searchForm.toDate=e}))("onSelect",(function(){return n.Dc(t),n.hc().resetListing()})),n.Ub(),n.Ub(),n.Ub(),n.Vb(26,"div",8),n.Vb(27,"div",14),n.Vb(28,"div",15),n.Vb(29,"p-table",16,17),n.dc("onLazyLoad",(function(e){return n.Dc(t),n.hc().getListing(e)})),n.Jc(31,U,63,34,"ng-template",18),n.Jc(32,N,28,18,"ng-template",19),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Sb()}if(2&t){const t=n.hc();n.Cb(6),n.oc("ngIf",t.screenAcl.download),n.Cb(8),n.oc("ngForOf",t.analyticsData),n.Cb(6),n.oc("ngModel",t.searchForm.fromDate)("monthNavigator",!0)("yearNavigator",!0)("yearRange",t.appConstants.PICKER_YEAR_RANGE)("dateFormat",t.appConstants.PICKER_DATE_FORMAT),n.Cb(5),n.oc("ngModel",t.searchForm.toDate)("monthNavigator",!0)("yearNavigator",!0)("yearRange",t.appConstants.PICKER_YEAR_RANGE)("dateFormat",t.appConstants.PICKER_DATE_FORMAT)("minDate",t.searchForm.fromDate),n.Cb(4),n.oc("value",t.listing.data)("lazy",!0)("paginator",!0)("rows",t.appConstants.TABLE_DEFAULT_ROWS)("totalRecords",t.listing.totalRecords)}}let E=(()=>{class t{constructor(t,e,i,s,o){this.utilsService=t,this.storageService=e,this.authGuardService=i,this.commonDataService=s,this.activityDataService=o,this.appConstants=r.h,this.screenAcl={},this.analyticsData=[],this.statusList=[],this.activityTypeList=[],this.priorityList=[],this.listingProperties={},this.listing={data:[],totalRecords:0},this.searchForm={sapId:"",activityNo:"",activityTypeId:"",assignedToName:"",partnerName:"",startDateTime:"",priorityId:"",status:"1",fromDate:"",toDate:"",branchName:""}}ngOnInit(){if(this.screenAcl=this.authGuardService.getScreenAcl("4"),!this.screenAcl.view)return this.utilsService.showFailureMsg(r.h.ACL_UNAUTHORIZED_MSG),this.utilsService.goBack(),!1;this.getAutoSuggestionList("getActivityStatusList"),this.getAutoSuggestionList("getMasterActivityList"),this.getAutoSuggestionList("getActivityPriorityTypeList"),this.getAnalyticsData()}getListing(t){const e=Object.assign({},this.searchForm);e.fromDate=this.utilsService.getBackendDateFormat(this.searchForm.fromDate),e.toDate=this.utilsService.getBackendDateFormat(this.searchForm.toDate),e.startDateTime=this.utilsService.getBackendDateFormat(this.searchForm.startDateTime);const i=this.utilsService.dataTableParameterFormation(t,e);this.listingProperties=i,this.activityDataService.getList(i).subscribe(t=>{"SUCCESS"===t.status?(this.listing.data=t.results.searchResults,this.listing.totalRecords=t.results.totalRecords):this.utilsService.showFailureMsg(t)})}clearSearchForm(){this.searchForm={sapId:"",activityNo:"",activityTypeId:"",assignedToName:"",partnerName:"",startDateTime:"",priorityId:"",status:"1",fromDate:"",toDate:"",branchName:""},this.resetListing()}resetListing(){this.dataTable.reset()}getAutoSuggestionList(t){this.commonDataService.getAutoSuggestionList(t).subscribe(e=>{if("SUCCESS"===e.status){let i="";"getActivityStatusList"===t?i="statusList":"getMasterActivityList"===t?i="activityTypeList":"getActivityPriorityTypeList"===t&&(i="priorityList"),this[i]=e.results}else this.utilsService.showFailureMsg(e)})}getAnalyticsData(){this.activityDataService.getAnalyticsData().subscribe(t=>{"SUCCESS"===t.status?(this.analyticsData=t.results,this.analyticsData=o.orderBy(this.analyticsData,["id"],["asc"])):this.utilsService.showFailureMsg(t)})}downloadAsExcel(){this.activityDataService.downloadAsExcel(this.listingProperties).subscribe(t=>{"SUCCESS"===t.status?this.utilsService.externalRedirect(t.fileUrl):this.utilsService.showFailureMsg(t)})}}return t.\u0275fac=function(e){return new(e||t)(n.Pb(r.g),n.Pb(r.f),n.Pb(r.a),n.Pb(a.l),n.Pb(a.b))},t.\u0275cmp=n.Jb({type:t,selectors:[["app-activity-list"]],viewQuery:function(t,e){var i;1&t&&n.Pc(p,!0),2&t&&n.zc(i=n.ec())&&(e.dataTable=i.first)},decls:1,vars:1,consts:[[4,"ngIf"],[1,"page-title"],[1,"btn-group"],["class","btn btn-success btn-sm",3,"click",4,"ngIf"],["routerLink","/branch/crm/activity-add",1,"btn","btn-primary","btn-sm"],[1,"fa","fa-plus"],[1,"working-container"],[1,"analytics"],[1,"row"],["class","col-lg-2 col-md-3 col-sm-4 col-xs-12",4,"ngFor","ngForOf"],[1,"form-group","col-sm-3"],[1,"form-label"],["appendTo","body",3,"ngModel","monthNavigator","yearNavigator","yearRange","dateFormat","ngModelChange","onSelect"],["appendTo","body",3,"ngModel","monthNavigator","yearNavigator","yearRange","dateFormat","minDate","ngModelChange","onSelect"],[1,"col-12"],[1,"datatable-responsive"],["sortField","startDateTime",3,"value","lazy","paginator","rows","totalRecords","onLazyLoad"],["dataTable",""],["pTemplate","header"],["pTemplate","body"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"fa","fa-file-excel"],[1,"col-lg-2","col-md-3","col-sm-4","col-xs-12"],[1,"item"],[1,"name"],[1,"count",3,"ngClass"],[2,"width","100px"],["style","width:150px",3,"pSortableColumn",4,"ngIf"],["style","width:110px",3,"pSortableColumn",4,"ngIf"],[2,"width","120px",3,"pSortableColumn"],[3,"field"],[2,"width","100px",3,"pSortableColumn"],[2,"width","250px",3,"pSortableColumn"],[2,"width","140px",3,"pSortableColumn"],[2,"width","200px"],["placement","top","container","body","tooltip","Press Enter key to search",1,"search"],[1,"clear-search",3,"click"],[1,"fa","fa-times"],["type","text",1,"form-control","form-control-sm",3,"ngModel","ngModelChange","change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","text",1,"form-control","form-control-sm",3,"ngModel","ngModelChange","keyup.enter"],[1,"form-control","form-control-sm",3,"ngModel","ngModelChange","change"],[2,"width","150px",3,"pSortableColumn"],[2,"width","110px",3,"pSortableColumn"],[3,"value"],["placement","top","container","body","tooltip","Edit",1,"action","blue",3,"routerLink"],[1,"fa","fa-edit"],["class","badge badge-danger",4,"ngIf"],[1,"badge",3,"ngClass"],["height","20px",3,"src"],["placement","top","container","body",1,"single-line",3,"tooltip"],[1,"badge","badge-danger"]],template:function(t,e){1&t&&n.Jc(0,T,33,18,"ng-container",0),2&t&&n.oc("ngIf",e.screenAcl.view)},directives:[c.m,s.e,c.l,b.a,u.m,u.o,d.c,l.b,c.k,d.b,d.a,m.a,u.t,u.p,u.v,u.b,s.g],styles:[""]}),t})();var A=i("w9rb"),R=i("TlXv"),P=i("IzNV"),M=i("fIZe"),k=i("ZOsW");function O(t,e){1&t&&(n.Tb(0),n.Lc(1,"Add"),n.Sb())}function w(t,e){1&t&&(n.Tb(0),n.Lc(1,"Edit"),n.Sb())}function J(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.activityNo," ")}}function x(t,e){if(1&t&&(n.Vb(0,"option",50),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Mc(t.activityName)}}function B(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.activityTypeId," ")}}function Q(t,e){if(1&t&&(n.Vb(0,"div"),n.Lc(1),n.Vb(2,"small"),n.Lc(3),n.Ub(),n.Ub()),2&t){const t=e.item;n.Cb(1),n.Nc("",t.employeeName,"\xa0"),n.Cb(2),n.Nc("(",t.empCode,")")}}function _(t,e){if(1&t){const t=n.Wb();n.Vb(0,"span",51),n.dc("click",(function(){n.Dc(t);const e=n.hc();return e.popupExternalService.showDetailPopup("employee",e.myForm1Data.assignedToId)})),n.Qb(1,"i",52),n.Ub()}}function q(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.assignedToId," ")}}function j(t,e){if(1&t&&(n.Vb(0,"div"),n.Lc(1),n.Vb(2,"small"),n.Lc(3),n.Ub(),n.Ub()),2&t){const t=e.item;n.Cb(1),n.Nc("",t.partnerName,"\xa0"),n.Cb(2),n.Nc("(",t.partnerCode,")")}}function z(t,e){if(1&t){const t=n.Wb();n.Vb(0,"a",53),n.dc("click",(function(){return n.Dc(t),n.hc().bizRefreshFlag=!0})),n.Qb(1,"i",54),n.Ub()}}function K(t,e){if(1&t){const t=n.Wb();n.Vb(0,"a",55),n.dc("click",(function(){n.Dc(t);const e=n.hc();return e.getAutoSuggestionList("getBusinessPartnerList"),e.bizRefreshFlag=!1})),n.Qb(1,"i",56),n.Ub()}}function G(t,e){if(1&t){const t=n.Wb();n.Vb(0,"span",51),n.dc("click",(function(){n.Dc(t);const e=n.hc();return e.popupExternalService.showDetailPopup("biz-partner",e.myForm1Data.businessPartnerId)})),n.Qb(1,"i",52),n.Ub()}}function W(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.businessPartnerId," ")}}function $(t,e){if(1&t&&(n.Vb(0,"div"),n.Lc(1),n.Ub(),n.Vb(2,"small"),n.Lc(3),n.Ub()),2&t){const t=e.item;n.Cb(1),n.Mc(t.contactName),n.Cb(2),n.Oc("",t.contactTypeName," / ",t.contactNumber,"")}}function Y(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.bpContactsId," ")}}function H(t,e){1&t&&(n.Vb(0,"span",13),n.Lc(1,"*"),n.Ub())}function Z(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.distributionRulesId," ")}}function X(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.remarks," ")}}function tt(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.startDateTime," ")}}function et(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.endDateTime," ")}}function it(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.reminderBeforeTime," ")}}function st(t,e){if(1&t&&(n.Vb(0,"option",50),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Mc(t.name)}}function ot(t,e){if(1&t&&(n.Vb(0,"option",50),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Mc(t.name)}}function rt(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.priorityId," ")}}function nt(t,e){if(1&t&&(n.Vb(0,"option",50),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Mc(t.name)}}function at(t,e){if(1&t&&(n.Vb(0,"div",49),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.status," ")}}function ct(t,e){if(1&t&&(n.Vb(0,"option",50),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Mc(t.screenName)}}function bt(t,e){if(1&t){const t=n.Wb();n.Vb(0,"button",57),n.dc("click",(function(){return n.Dc(t),n.hc().saveUpdate()})),n.Qb(1,"i",58),n.Vb(2,"span"),n.Lc(3,"Save"),n.Ub(),n.Ub()}}function ut(t,e){if(1&t){const t=n.Wb();n.Vb(0,"button",3),n.dc("click",(function(){return n.Dc(t),n.hc().clearForm()})),n.Qb(1,"i",59),n.Vb(2,"span"),n.Lc(3,"Clear"),n.Ub(),n.Ub()}}function dt(t,e){if(1&t){const t=n.Wb();n.Vb(0,"button",57),n.dc("click",(function(){return n.Dc(t),n.hc().saveUpdate()})),n.Qb(1,"i",56),n.Vb(2,"span"),n.Lc(3,"Update"),n.Ub(),n.Ub()}}function lt(t,e){if(1&t){const t=n.Wb();n.Vb(0,"button",3),n.dc("click",(function(){return n.Dc(t),n.hc().utilsService.goBack()})),n.Qb(1,"i",60),n.Vb(2,"span"),n.Lc(3,"Cancel"),n.Ub(),n.Ub()}}function mt(t,e){1&t&&(n.Vb(0,"div",63),n.Vb(1,"span",64),n.Lc(2,"Note:"),n.Ub(),n.Lc(3," You are unauthorized to "),n.Vb(4,"strong"),n.Lc(5,"update"),n.Ub(),n.Lc(6," this transaction! "),n.Ub())}function pt(t,e){1&t&&(n.Vb(0,"div",63),n.Vb(1,"span",64),n.Lc(2,"Note:"),n.Ub(),n.Lc(3," Cannot update "),n.Vb(4,"strong"),n.Lc(5,"In-Active"),n.Ub(),n.Lc(6," / "),n.Vb(7,"strong"),n.Lc(8,"Closed"),n.Ub(),n.Lc(9," transactions! "),n.Ub())}function ht(t,e){if(1&t&&(n.Vb(0,"div",61),n.Vb(1,"div"),n.Vb(2,"strong"),n.Lc(3,"Created By:"),n.Ub(),n.Lc(4),n.Ub(),n.Jc(5,mt,7,0,"div",62),n.Jc(6,pt,10,0,"div",62),n.Ub()),2&t){const t=n.hc();n.Cb(4),n.Nc(" ",t.editCreatedName,""),n.Cb(1),n.oc("ngIf",!t.screenAcl.update),n.Cb(1),n.oc("ngIf","1"!==t.editStatusId)}}function gt(t,e){1&t&&(n.Vb(0,"div",61),n.Vb(1,"span",64),n.Lc(2,"Note:"),n.Ub(),n.Lc(3," You are unauthorized to "),n.Vb(4,"strong"),n.Lc(5,"add"),n.Ub(),n.Lc(6," this transaction!. "),n.Ub())}let yt=(()=>{class t{constructor(t,e,i,s,o,n,a,c,b){this.utilsService=t,this.storageService=e,this.authGuardService=i,this.branchUtilsService=s,this.commonDataService=o,this.activityDataService=n,this.activatedRoute=a,this.formBuilder=c,this.popupExternalService=b,this.appConstants=r.h,this.screenAcl={},this.bizRefreshFlag=!1,this.statusList=[],this.businessPartnerList=[],this.bpContactList=[],this.distributionList=[],this.activityTypeList=[],this.priorityList=[],this.recurrenceList=[],this.documentTypeList=[],this.reminderTypeList=[],this.employeeList=[],this.documentList=[],this.myForm1Data={},this.myFormErrors1={activityNo:"",activityTypeId:"",assignedToId:"",businessPartnerId:"",bpContactsId:"",distributionRulesId:"",remarks:"",startDateTime:"",endDateTime:"",reminderBeforeTime:"",priorityId:"",status:""},this.myFormValidationMsgs1={activityNo:{required:"Activity Number is required"},activityTypeId:{required:"Activity Type is required"},assignedToId:{required:"Assigned To is required"},businessPartnerId:{required:"Business Partner Name is required"},bpContactsId:{required:"Business Partner Contact is required"},distributionRulesId:{required:"Dist.Rules is required"},remarks:{required:"Remarks is required"},startDateTime:{required:"Start Date Time is required"},endDateTime:{required:"End Date Time is required"},reminderBeforeTime:{pattern:"Only positive numbers are allowed"},priorityId:{required:"Priority is required"},status:{required:"Status is required"}}}ngOnInit(){if(this.screenAcl=this.authGuardService.getScreenAcl("4"),!this.screenAcl.view)return this.utilsService.showFailureMsg(r.h.ACL_UNAUTHORIZED_MSG),this.utilsService.goBack(),!1;this.initializeForm1(),this.initializeSubscriptions(),this.getAutoSuggestionList("getActivityStatusList"),this.getAutoSuggestionList("getActivityReminderTypeList"),this.getAutoSuggestionList("getMasterActivityList"),this.getAutoSuggestionList("getActivityPriorityTypeList"),this.getAutoSuggestionList("getActivityRecurrenceTypeList"),this.getAutoSuggestionList("getDocumentTypeList")}ngAfterViewInit(){this.attachmentsComponent.loadAttachments(this.inputEditId),this.udfViewerComponent.getFields(this.inputEditId)}initializeSubscriptions(){this.activatedRoute.params.subscribe(t=>{t.id?(this.inputEditId=this.utilsService.decrypt(t.id),this.get()):(this.getAutoSuggestionList("getBusinessPartnerList"),this.getAutoSuggestionList("getEmployeeList"),this.getDistributionList()),t.bpId&&this.myForm1.patchValue({businessPartnerId:t.bpId})})}initializeForm1(){this.myForm1=this.formBuilder.group({activityNo:[{value:"AUTO",disabled:!0},[u.u.required]],activityTypeId:["",[u.u.required]],assignedToId:[this.storageService.get("userId"),[u.u.required]],businessPartnerId:[null,[u.u.required]],bpContactsId:[null,[u.u.required]],distributionRulesId:[null],remarks:["",[u.u.required]],startDateTime:["",[u.u.required]],endDateTime:["",[u.u.required]],recurrenceTypeId:[""],recurrenceEndDate:[""],reminderBeforeTime:[0,[u.u.pattern(r.h.VALIDATION_PATTERNS.positiveIntNumber)]],reminderTypeId:[""],priorityId:[2,[u.u.required]],status:[1,[u.u.required]],documentTypeId:[""],documentId:[null]}),this.myForm1.valueChanges.subscribe(t=>{this.utilsService.validation(this.myForm1,this.myFormErrors1,this.myFormValidationMsgs1),this.myForm1Data=this.myForm1.getRawValue()}),this.myForm1Data=this.myForm1.getRawValue(),this.storageService.get("distRulesMode")&&this.myForm1.controls.distributionRulesId.setValidators(u.u.required)}saveUpdate(){if(!this.myForm1.valid||!this.udfViewerComponent.valid())return this.utilsService.validation(this.myForm1,this.myFormErrors1,this.myFormValidationMsgs1,!0),this.udfViewerComponent.checkValidations(),!1;const t={activityNo:this.myForm1Data.activityNo,activityTypeId:this.myForm1Data.activityTypeId,assignedToId:this.myForm1Data.assignedToId,businessPartnerId:this.myForm1Data.businessPartnerId,bpContactsId:this.myForm1Data.bpContactsId,distributionRulesId:Array.isArray(this.myForm1Data.distributionRulesId)?this.myForm1Data.distributionRulesId.join(","):"",remarks:this.myForm1Data.remarks,startDateTime:this.utilsService.getBackendDateFormat(this.myForm1Data.startDateTime,!0),endDateTime:this.utilsService.getBackendDateFormat(this.myForm1Data.endDateTime,!0),recurrenceTypeId:this.myForm1Data.recurrenceTypeId,recurrenceEndDate:this.utilsService.getBackendDateFormat(this.myForm1Data.recurrenceEndDate),reminderBeforeTime:this.myForm1Data.reminderBeforeTime,reminderTypeId:this.myForm1Data.reminderTypeId,priorityId:this.myForm1Data.priorityId,status:this.myForm1Data.status,documentTypeId:this.myForm1Data.documentTypeId,documentId:this.myForm1Data.documentId,udfFields:JSON.stringify(this.udfViewerComponent.getFormValues())};let e;this.inputEditId?(e="update",t.id=this.inputEditId):e="save",this.activityDataService[e](t).subscribe(t=>{"SUCCESS"===t.status?(this.utilsService.showSuccessMsg(t),this.attachmentsComponent.save("save"===e?t.sId:this.inputEditId)):this.utilsService.showFailureMsg(t)})}get(){this.activityDataService.get(this.inputEditId).subscribe(t=>{if("SUCCESS"===t.status){const e=t.results[0],i={};this.utilsService.updateObject(i,"activityNo",e.activityNo),this.utilsService.updateObject(i,"activityTypeId",e.activityTypeId),this.utilsService.updateObject(i,"assignedToId",e.assignedToId),this.utilsService.updateObject(i,"businessPartnerId",e.businessPartnerId),this.utilsService.updateObject(i,"bpContactsId",e.bpContactsId),this.utilsService.isEmpty(e.distributionRulesId)||(i.distributionRulesId=this.branchUtilsService.distRulesRemoveZeroPatternOnEdit(e.distributionRulesId)),this.utilsService.updateObject(i,"remarks",e.remarks),this.utilsService.updateObject(i,"startDateTime",e.startDateTime,"date"),this.utilsService.updateObject(i,"endDateTime",e.endDateTime,"date"),this.utilsService.updateObject(i,"recurrenceTypeId",e.recurrenceTypeId),this.utilsService.updateObject(i,"recurrenceEndDate",e.recurrenceEndDate,"date"),this.utilsService.updateObject(i,"reminderBeforeTime",e.reminderBeforeTime),this.utilsService.updateObject(i,"reminderTypeId",e.reminderTypeId),this.utilsService.updateObject(i,"priorityId",e.priorityId),this.utilsService.updateObject(i,"status",e.status),this.utilsService.updateObject(i,"documentTypeId",e.documentTypeId),this.utilsService.updateObject(i,"documentId",e.documentId),this.myForm1.patchValue(i),this.getAutoSuggestionList("getBusinessPartnerList",e.businessPartnerInfo),this.getAutoSuggestionList("getEmployeeList",e.assignedToInfo),this.getDistributionList(e.distributionRulesInfo),this.getBpContactList(!0,e.bpContactsInfo),this.getDocumentList(!0,e.documentInfo),this.editStatusId=e.status,this.editCreatedName=e.createdByInfo[0].employeeName,"1"===this.editStatusId?this.myForm1.controls.businessPartnerId.disable():this.myForm1.enable()}else this.utilsService.showFailureMsg(t)})}clearForm(){this.initializeForm1()}redirectToList(){this.utilsService.redirect("/branch/crm/activity-list")}onStartTimeChange(){this.myForm1.patchValue({endDateTime:""})}resetDocument(){this.myForm1.patchValue({documentTypeId:"",documentId:null})}onDistRuleAdd(){this.branchUtilsService.distRulesCheckUnique(this.distributionList,this.myForm1,"distributionRulesId")}getAutoSuggestionList(t,e){this.commonDataService.getAutoSuggestionList(t).subscribe(i=>{"SUCCESS"===i.status?(this.utilsService.ifNotPushToList(i.results,e),"getActivityStatusList"===t?(this.inputEditId||(i.results=i.results.filter(t=>"1"===t.id)),this.statusList=i.results):"getBusinessPartnerList"===t?this.businessPartnerList=i.results.map(t=>(t.searchText=t.partnerName+" - "+t.partnerCode,t)):"getMasterActivityList"===t?this.activityTypeList=i.results:"getActivityPriorityTypeList"===t?this.priorityList=i.results:"getActivityRecurrenceTypeList"===t?this.recurrenceList=i.results:"getDocumentTypeList"===t?this.documentTypeList=i.results:"getActivityReminderTypeList"===t?this.reminderTypeList=i.results:"getEmployeeList"===t&&(this.employeeList=i.results.map(t=>(t.searchText=t.employeeName+" - "+t.empCode,t)))):this.utilsService.showFailureMsg(i)})}getBpContactList(t,e){this.bpContactList=[],this.branchUtilsService.getBpContactListAndSet(this.myForm1,"bpContactsId","businessPartnerId",t,e).subscribe(t=>{this.bpContactList=t})}getDocumentList(t,e){const i=this.myForm1Data.documentTypeId,s=this.myForm1Data.businessPartnerId;if(this.documentList=[],t||this.myForm1.patchValue({documentId:null}),!s)return this.utilsService.showFailureMsg("Select business partner to get the appropriate documents!"),this.myForm1.patchValue({documentTypeId:""}),!1;this.utilsService.isEmpty(i)||this.commonDataService.getDocumentList(i,s).subscribe(i=>{"SUCCESS"===i.status?(this.documentList=i.results,t&&this.utilsService.ifNotPushToList(this.documentList,e)):this.utilsService.showFailureMsg(i)})}getDistributionList(t){this.commonDataService.getDistributionList(!0).subscribe(e=>{"SUCCESS"===e.status?(this.utilsService.ifNotPushToList(e.results,t),this.distributionList=e.results):this.utilsService.showFailureMsg(e)})}onKeydownHandler(t){t.ctrlKey&&"s"===t.key.toLowerCase()&&(this.inputEditId&&"1"===this.editStatusId||!this.inputEditId)&&(this.saveUpdate(),t.preventDefault())}}return t.\u0275fac=function(e){return new(e||t)(n.Pb(r.g),n.Pb(r.f),n.Pb(r.a),n.Pb(P.a),n.Pb(a.l),n.Pb(a.b),n.Pb(s.a),n.Pb(u.e),n.Pb(M.a))},t.\u0275cmp=n.Jb({type:t,selectors:[["app-activity-add"]],viewQuery:function(t,e){var i;1&t&&(n.Pc(A.a,!0),n.Pc(R.a,!0)),2&t&&(n.zc(i=n.ec())&&(e.attachmentsComponent=i.first),n.zc(i=n.ec())&&(e.udfViewerComponent=i.first))},hostBindings:function(t,e){1&t&&n.dc("keydown",(function(t){return e.onKeydownHandler(t)}),!1,n.Bc)},decls:156,vars:54,consts:[[1,"page-title"],[4,"ngIf"],[1,"btn-group"],[1,"btn","btn-secondary","btn-sm",3,"click"],[1,"fa","fa-arrow-left"],[1,"working-container",3,"formGroup"],[1,"box"],[1,"box-header"],[1,"fa","fa-angle-right"],[1,"box-body","box-form"],[1,"row"],[1,"form-group","col-sm-3"],[1,"form-label"],[1,"mandatory"],["type","text","formControlName","activityNo",1,"form-control","form-control-sm"],["class","validation-error",4,"ngIf"],["formControlName","activityTypeId",1,"form-control","form-control-sm"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"position-relative"],["formControlName","assignedToId","bindLabel","searchText","bindValue","id","placeholder","--SELECT--",3,"items","multiple"],["ng-option-tmp",""],["class","info-icon","container","body","tooltip","View Details",3,"click",4,"ngIf"],[1,"action-control"],["formControlName","businessPartnerId","bindLabel","searchText","bindValue","id","placeholder","--SELECT--",3,"items","multiple","clear","change"],["target","_blank","routerLink","/branch/bp/biz-partner-add",3,"click",4,"ngIf"],[3,"click",4,"ngIf"],["formControlName","bpContactsId","bindLabel","contactName","bindValue","id","placeholder","--SELECT--",3,"items","multiple"],["class","mandatory",4,"ngIf"],["formControlName","distributionRulesId","bindLabel","distributionName","bindValue","id","placeholder","--SELECT--","groupBy","dimensionDescription",3,"items","multiple","add"],["formControlName","remarks","rows","2",1,"form-control","form-control-sm"],["formControlName","startDateTime",3,"monthNavigator","yearNavigator","yearRange","dateFormat","showTime","onSelect"],["formControlName","endDateTime",3,"monthNavigator","yearNavigator","yearRange","dateFormat","showTime","minDate"],["endDateTime",""],[1,"small-text"],[1,"col-sm-6"],["type","text","formControlName","reminderBeforeTime",1,"form-control","form-control-sm"],["formControlName","reminderTypeId",1,"form-control","form-control-sm"],["formControlName","priorityId",1,"form-control","form-control-sm"],["formControlName","status",1,"form-control","form-control-sm"],["formControlName","documentTypeId",1,"form-control","form-control-sm",3,"change"],["formControlName","documentId","bindLabel","documentNumber","bindValue","id","placeholder","--SELECT--",3,"items","multiple"],[3,"type"],[3,"type","doSuccess"],[1,"btn-group","text-right"],["class","btn btn-primary btn-sm",3,"click",4,"ngIf"],["class","btn btn-secondary btn-sm",3,"click",4,"ngIf"],["class"," btn btn-primary btn-sm",3,"click",4,"ngIf"],["class","alert alert-info mt-3",4,"ngIf"],[1,"validation-error"],[3,"value"],["container","body","tooltip","View Details",1,"info-icon",3,"click"],[1,"fa","fa-info-circle"],["target","_blank","routerLink","/branch/bp/biz-partner-add",3,"click"],[1,"fa","fa-plus"],[3,"click"],[1,"fa","fa-redo-alt"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"fa","fa-save"],[1,"fa","fa-broom"],[1,"fa","fa-times"],[1,"alert","alert-info","mt-3"],["class","mt-2",4,"ngIf"],[1,"mt-2"],[1,"badge","badge-danger"]],template:function(t,e){1&t&&(n.Vb(0,"div",0),n.Vb(1,"span"),n.Lc(2,"A"),n.Ub(),n.Lc(3,"ctivity - "),n.Jc(4,O,2,0,"ng-container",1),n.Jc(5,w,2,0,"ng-container",1),n.Vb(6,"div",2),n.Vb(7,"button",3),n.dc("click",(function(){return e.utilsService.goBack()})),n.Qb(8,"i",4),n.Vb(9,"span"),n.Lc(10,"Back"),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(11,"div",5),n.Vb(12,"div",6),n.Vb(13,"div",7),n.Qb(14,"i",8),n.Lc(15,"Activity Info "),n.Ub(),n.Vb(16,"div",9),n.Vb(17,"div",10),n.Vb(18,"div",11),n.Vb(19,"label",12),n.Lc(20,"Activity Number"),n.Vb(21,"span",13),n.Lc(22,"*"),n.Ub(),n.Ub(),n.Qb(23,"input",14),n.Jc(24,J,2,1,"div",15),n.Ub(),n.Vb(25,"div",11),n.Vb(26,"label",12),n.Lc(27,"Activity Type"),n.Vb(28,"span",13),n.Lc(29,"*"),n.Ub(),n.Ub(),n.Vb(30,"select",16),n.Vb(31,"option",17),n.Lc(32,"--SELECT--"),n.Ub(),n.Jc(33,x,2,2,"option",18),n.Ub(),n.Jc(34,B,2,1,"div",15),n.Ub(),n.Vb(35,"div",11),n.Vb(36,"label",12),n.Lc(37,"Assigned To"),n.Vb(38,"span",13),n.Lc(39,"*"),n.Ub(),n.Ub(),n.Vb(40,"div",19),n.Vb(41,"ng-select",20),n.Jc(42,Q,4,2,"ng-template",21),n.Ub(),n.Jc(43,_,2,0,"span",22),n.Ub(),n.Jc(44,q,2,1,"div",15),n.Ub(),n.Vb(45,"div",11),n.Vb(46,"label",12),n.Lc(47,"Business Partner Name"),n.Vb(48,"span",13),n.Lc(49,"*"),n.Ub(),n.Ub(),n.Vb(50,"div",23),n.Vb(51,"ng-select",24),n.dc("clear",(function(){return e.getBpContactList()}))("change",(function(){return e.getBpContactList(),e.resetDocument()})),n.Jc(52,j,4,2,"ng-template",21),n.Ub(),n.Vb(53,"span"),n.Jc(54,z,2,0,"a",25),n.Jc(55,K,2,0,"a",26),n.Ub(),n.Jc(56,G,2,0,"span",22),n.Ub(),n.Jc(57,W,2,1,"div",15),n.Ub(),n.Vb(58,"div",11),n.Vb(59,"label",12),n.Lc(60,"Business Partner Contact"),n.Vb(61,"span",13),n.Lc(62,"*"),n.Ub(),n.Ub(),n.Vb(63,"ng-select",27),n.Jc(64,$,4,3,"ng-template",21),n.Ub(),n.Jc(65,Y,2,1,"div",15),n.Ub(),n.Vb(66,"div",11),n.Vb(67,"label",12),n.Lc(68,"Distribution Rules"),n.Jc(69,H,2,0,"span",28),n.Ub(),n.Vb(70,"ng-select",29),n.dc("add",(function(){return e.onDistRuleAdd()})),n.Ub(),n.Jc(71,Z,2,1,"div",15),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(72,"div",6),n.Vb(73,"div",7),n.Qb(74,"i",8),n.Lc(75,"General "),n.Ub(),n.Vb(76,"div",9),n.Vb(77,"div",10),n.Vb(78,"div",11),n.Vb(79,"label",12),n.Lc(80,"Remarks"),n.Vb(81,"span",13),n.Lc(82,"*"),n.Ub(),n.Ub(),n.Qb(83,"textarea",30),n.Jc(84,X,2,1,"div",15),n.Ub(),n.Vb(85,"div",11),n.Vb(86,"label",12),n.Lc(87,"Start Time"),n.Vb(88,"span",13),n.Lc(89,"*"),n.Ub(),n.Ub(),n.Vb(90,"p-calendar",31),n.dc("onSelect",(function(){return e.onStartTimeChange()})),n.Ub(),n.Jc(91,tt,2,1,"div",15),n.Ub(),n.Vb(92,"div",11),n.Vb(93,"label",12),n.Lc(94,"End Time"),n.Vb(95,"span",13),n.Lc(96,"*"),n.Ub(),n.Ub(),n.Qb(97,"p-calendar",32,33),n.Jc(99,et,2,1,"div",15),n.Ub(),n.Vb(100,"div",11),n.Vb(101,"label",12),n.Lc(102,"Reminder "),n.Vb(103,"span",34),n.Lc(104,"(Before)"),n.Ub(),n.Ub(),n.Vb(105,"div",10),n.Vb(106,"div",35),n.Qb(107,"input",36),n.Jc(108,it,2,1,"div",15),n.Ub(),n.Vb(109,"div",35),n.Vb(110,"select",37),n.Jc(111,st,2,2,"option",18),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(112,"div",11),n.Vb(113,"label",12),n.Lc(114,"Priority"),n.Vb(115,"span",13),n.Lc(116,"*"),n.Ub(),n.Ub(),n.Vb(117,"select",38),n.Vb(118,"option",17),n.Lc(119,"--SELECT--"),n.Ub(),n.Jc(120,ot,2,2,"option",18),n.Ub(),n.Jc(121,rt,2,1,"div",15),n.Ub(),n.Vb(122,"div",11),n.Vb(123,"label",12),n.Lc(124,"Status"),n.Vb(125,"span",13),n.Lc(126,"*"),n.Ub(),n.Ub(),n.Vb(127,"select",39),n.Jc(128,nt,2,2,"option",18),n.Ub(),n.Jc(129,at,2,1,"div",15),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(130,"div",6),n.Vb(131,"div",7),n.Qb(132,"i",8),n.Lc(133,"Linked Document "),n.Ub(),n.Vb(134,"div",9),n.Vb(135,"div",10),n.Vb(136,"div",11),n.Vb(137,"label",12),n.Lc(138,"Document Type"),n.Ub(),n.Vb(139,"select",40),n.dc("change",(function(){return e.getDocumentList()})),n.Vb(140,"option",17),n.Lc(141,"--SELECT--"),n.Ub(),n.Jc(142,ct,2,2,"option",18),n.Ub(),n.Ub(),n.Vb(143,"div",11),n.Vb(144,"label",12),n.Lc(145,"Document Number"),n.Ub(),n.Qb(146,"ng-select",41),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Qb(147,"app-udf-viewer",42),n.Vb(148,"app-attachments",43),n.dc("doSuccess",(function(){return e.redirectToList()})),n.Ub(),n.Vb(149,"div",44),n.Jc(150,bt,4,0,"button",45),n.Jc(151,ut,4,0,"button",46),n.Jc(152,dt,4,0,"button",47),n.Jc(153,lt,4,0,"button",46),n.Ub(),n.Jc(154,ht,7,3,"div",48),n.Jc(155,gt,7,0,"div",48),n.Ub()),2&t&&(n.Cb(4),n.oc("ngIf",!e.inputEditId),n.Cb(1),n.oc("ngIf",e.inputEditId),n.Cb(6),n.oc("formGroup",e.myForm1),n.Cb(13),n.oc("ngIf",e.myFormErrors1.activityNo),n.Cb(9),n.oc("ngForOf",e.activityTypeList),n.Cb(1),n.oc("ngIf",e.myFormErrors1.activityTypeId),n.Cb(7),n.oc("items",e.employeeList)("multiple",!1),n.Cb(2),n.oc("ngIf",e.myForm1Data.assignedToId),n.Cb(1),n.oc("ngIf",e.myFormErrors1.assignedToId),n.Cb(7),n.oc("items",e.businessPartnerList)("multiple",!1),n.Cb(3),n.oc("ngIf",!e.bizRefreshFlag),n.Cb(1),n.oc("ngIf",e.bizRefreshFlag),n.Cb(1),n.oc("ngIf",e.myForm1Data.businessPartnerId),n.Cb(1),n.oc("ngIf",e.myFormErrors1.businessPartnerId),n.Cb(6),n.oc("items",e.bpContactList)("multiple",!1),n.Cb(2),n.oc("ngIf",e.myFormErrors1.bpContactsId),n.Cb(4),n.oc("ngIf",e.storageService.get("distRulesMode")),n.Cb(1),n.oc("items",e.distributionList)("multiple",!0),n.Cb(1),n.oc("ngIf",e.myFormErrors1.distributionRulesId),n.Cb(13),n.oc("ngIf",e.myFormErrors1.remarks),n.Cb(6),n.oc("monthNavigator",!0)("yearNavigator",!0)("yearRange",e.appConstants.PICKER_YEAR_RANGE)("dateFormat",e.appConstants.PICKER_DATE_FORMAT)("showTime",!0),n.Cb(1),n.oc("ngIf",e.myFormErrors1.startDateTime),n.Cb(6),n.oc("monthNavigator",!0)("yearNavigator",!0)("yearRange",e.appConstants.PICKER_YEAR_RANGE)("dateFormat",e.appConstants.PICKER_DATE_FORMAT)("showTime",!0)("minDate",e.myForm1Data.startDateTime),n.Cb(2),n.oc("ngIf",e.myFormErrors1.endDateTime),n.Cb(9),n.oc("ngIf",e.myFormErrors1.reminderBeforeTime),n.Cb(3),n.oc("ngForOf",e.reminderTypeList),n.Cb(9),n.oc("ngForOf",e.priorityList),n.Cb(1),n.oc("ngIf",e.myFormErrors1.priorityId),n.Cb(7),n.oc("ngForOf",e.statusList),n.Cb(1),n.oc("ngIf",e.myFormErrors1.status),n.Cb(13),n.oc("ngForOf",e.documentTypeList),n.Cb(4),n.oc("items",e.documentList)("multiple",!1),n.Cb(1),n.oc("type",e.branchUtilsService.screenAttributes.activity.backendKey),n.Cb(1),n.oc("type",e.branchUtilsService.screenAttributes.activity.backendKey),n.Cb(2),n.oc("ngIf",e.screenAcl.add&&!e.inputEditId),n.Cb(1),n.oc("ngIf",!e.inputEditId),n.Cb(1),n.oc("ngIf",e.screenAcl.update&&e.inputEditId&&"1"===e.editStatusId),n.Cb(1),n.oc("ngIf",e.inputEditId),n.Cb(1),n.oc("ngIf",e.inputEditId),n.Cb(1),n.oc("ngIf",!e.inputEditId&&!e.screenAcl.add))},directives:[c.m,u.n,u.i,u.b,u.m,u.g,u.t,u.p,u.v,c.l,k.a,k.c,b.a,R.a,A.a,m.a,s.g],styles:[""]}),t})();const ft=["dataTable"];function vt(t,e){if(1&t){const t=n.Wb();n.Vb(0,"button",20),n.dc("click",(function(){return n.Dc(t),n.hc(2).downloadAsExcel()})),n.Qb(1,"i",21),n.Vb(2,"span"),n.Lc(3,"Download as Excel"),n.Ub(),n.Ub()}}function Lt(t,e){if(1&t&&(n.Vb(0,"div",22),n.Vb(1,"div",23),n.Vb(2,"div",24),n.Lc(3),n.Ub(),n.Vb(4,"div",25),n.Lc(5),n.Ub(),n.Ub(),n.Ub()),2&t){const t=e.$implicit,i=n.hc(2);n.Cb(3),n.Nc(" ",t.name," "),n.Cb(1),n.oc("ngClass",i.appConstants.OPPORTUNITY_STATUS_COLOR_CLS[t.id]),n.Cb(1),n.Mc(t.count)}}function Ct(t,e){1&t&&(n.Vb(0,"th",45),n.Lc(1," Branch Name"),n.Qb(2,"p-sortIcon",30),n.Ub()),2&t&&(n.oc("pSortableColumn","branchName"),n.Cb(2),n.oc("field","branchName"))}function St(t,e){1&t&&(n.Vb(0,"th",46),n.Lc(1,"Sap Doc No"),n.Qb(2,"p-sortIcon",30),n.Ub()),2&t&&(n.oc("pSortableColumn","sapId"),n.Cb(2),n.oc("field","sapId"))}function It(t,e){if(1&t){const t=n.Wb();n.Vb(0,"th"),n.Vb(1,"input",47),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(3).searchForm.branchName=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(3).resetListing()})),n.Ub(),n.Ub()}if(2&t){const t=n.hc(3);n.Cb(1),n.oc("ngModel",t.searchForm.branchName)}}function Ut(t,e){if(1&t){const t=n.Wb();n.Vb(0,"th"),n.Vb(1,"input",40),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(3).searchForm.sapId=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(3).resetListing()})),n.Ub(),n.Ub()}if(2&t){const t=n.hc(3);n.Cb(1),n.oc("ngModel",t.searchForm.sapId)}}function Vt(t,e){if(1&t&&(n.Vb(0,"option",48),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Nc(" ",t.name," ")}}function Dt(t,e){if(1&t){const t=n.Wb();n.Vb(0,"tr"),n.Vb(1,"th",26),n.Lc(2,"Actions"),n.Ub(),n.Jc(3,Ct,3,2,"th",27),n.Jc(4,St,3,2,"th",28),n.Vb(5,"th",29),n.Lc(6,"Opportunity No"),n.Qb(7,"p-sortIcon",30),n.Ub(),n.Vb(8,"th",31),n.Lc(9,"Opportunity Name"),n.Qb(10,"p-sortIcon",30),n.Ub(),n.Vb(11,"th",32),n.Lc(12,"Business Partner Name"),n.Qb(13,"p-sortIcon",30),n.Ub(),n.Vb(14,"th",32),n.Lc(15,"Sales Employee"),n.Qb(16,"p-sortIcon",30),n.Ub(),n.Vb(17,"th",33),n.Lc(18,"Current Stage"),n.Ub(),n.Vb(19,"th",34),n.Lc(20,"Status"),n.Qb(21,"p-sortIcon",30),n.Ub(),n.Vb(22,"th",35),n.Lc(23,"Start Date"),n.Qb(24,"p-sortIcon",30),n.Ub(),n.Vb(25,"th",34),n.Lc(26,"Closing Date"),n.Qb(27,"p-sortIcon",30),n.Ub(),n.Vb(28,"th",31),n.Lc(29,"Potential Amount"),n.Qb(30,"p-sortIcon",30),n.Ub(),n.Vb(31,"th",36),n.Lc(32,"Distribution Rules"),n.Ub(),n.Ub(),n.Vb(33,"tr",37),n.Vb(34,"th"),n.Vb(35,"a",38),n.dc("click",(function(){return n.Dc(t),n.hc(2).clearSearchForm()})),n.Qb(36,"i",39),n.Lc(37,"Clear"),n.Ub(),n.Ub(),n.Jc(38,It,2,1,"th",0),n.Jc(39,Ut,2,1,"th",0),n.Vb(40,"th"),n.Vb(41,"input",40),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.opportunityNo=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Ub(),n.Ub(),n.Vb(42,"th"),n.Vb(43,"input",40),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.opportunityName=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Ub(),n.Ub(),n.Vb(44,"th"),n.Vb(45,"input",40),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.partnerName=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Ub(),n.Ub(),n.Vb(46,"th"),n.Vb(47,"input",40),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.empName=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Ub(),n.Ub(),n.Qb(48,"th"),n.Vb(49,"th"),n.Vb(50,"select",41),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.opportunityStatus=e}))("change",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Vb(51,"option",42),n.Lc(52,"--SELECT--"),n.Ub(),n.Jc(53,Vt,2,2,"option",43),n.Ub(),n.Ub(),n.Vb(54,"th"),n.Vb(55,"p-calendar",12),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.startDate=e}))("onSelect",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Ub(),n.Ub(),n.Vb(56,"th"),n.Vb(57,"p-calendar",12),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.closingDate=e}))("onSelect",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Ub(),n.Ub(),n.Vb(58,"th"),n.Vb(59,"input",44),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc(2).searchForm.potentialAmount=e}))("keyup.enter",(function(){return n.Dc(t),n.hc(2).resetListing()})),n.Ub(),n.Ub(),n.Qb(60,"th"),n.Ub()}if(2&t){const t=n.hc(2);n.Cb(3),n.oc("ngIf",!t.storageService.get("isSingleBranchUser")),n.Cb(1),n.oc("ngIf",t.storageService.get("isSap")),n.Cb(1),n.oc("pSortableColumn","opportunityNo"),n.Cb(2),n.oc("field","opportunityNo"),n.Cb(1),n.oc("pSortableColumn","opportunityName"),n.Cb(2),n.oc("field","opportunityName"),n.Cb(1),n.oc("pSortableColumn","partnerName"),n.Cb(2),n.oc("field","partnerName"),n.Cb(1),n.oc("pSortableColumn","empName"),n.Cb(2),n.oc("field","empName"),n.Cb(3),n.oc("pSortableColumn","opportunityStatus"),n.Cb(2),n.oc("field","opportunityStatus"),n.Cb(1),n.oc("pSortableColumn","startDate"),n.Cb(2),n.oc("field","startDate"),n.Cb(1),n.oc("pSortableColumn","closingDate"),n.Cb(2),n.oc("field","closingDate"),n.Cb(1),n.oc("pSortableColumn","potentialAmount"),n.Cb(2),n.oc("field","potentialAmount"),n.Cb(8),n.oc("ngIf",!t.storageService.get("isSingleBranchUser")),n.Cb(1),n.oc("ngIf",t.storageService.get("isSap")),n.Cb(2),n.oc("ngModel",t.searchForm.opportunityNo),n.Cb(2),n.oc("ngModel",t.searchForm.opportunityName),n.Cb(2),n.oc("ngModel",t.searchForm.partnerName),n.Cb(2),n.oc("ngModel",t.searchForm.empName),n.Cb(3),n.oc("ngModel",t.searchForm.opportunityStatus),n.Cb(3),n.oc("ngForOf",t.statusList),n.Cb(2),n.oc("ngModel",t.searchForm.startDate)("monthNavigator",!0)("yearNavigator",!0)("yearRange",t.appConstants.PICKER_YEAR_RANGE)("dateFormat",t.appConstants.PICKER_DATE_FORMAT),n.Cb(2),n.oc("ngModel",t.searchForm.closingDate)("monthNavigator",!0)("yearNavigator",!0)("yearRange",t.appConstants.PICKER_YEAR_RANGE)("dateFormat",t.appConstants.PICKER_DATE_FORMAT),n.Cb(2),n.oc("ngModel",t.searchForm.potentialAmount)}}function Ft(t,e){if(1&t&&(n.Vb(0,"td"),n.Lc(1),n.Ub()),2&t){const t=n.hc().$implicit;n.Cb(1),n.Mc(t.branchName)}}function Nt(t,e){if(1&t&&(n.Vb(0,"td"),n.Lc(1),n.Ub()),2&t){const t=n.hc().$implicit;n.Cb(1),n.Mc(t.sapId)}}function Tt(t,e){if(1&t&&(n.Vb(0,"tr"),n.Vb(1,"td"),n.Vb(2,"a",49),n.Qb(3,"i",50),n.Ub(),n.Ub(),n.Jc(4,Ft,2,1,"td",0),n.Jc(5,Nt,2,1,"td",0),n.Vb(6,"td"),n.Lc(7),n.Ub(),n.Vb(8,"td"),n.Lc(9),n.Ub(),n.Vb(10,"td"),n.Lc(11),n.Ub(),n.Vb(12,"td"),n.Qb(13,"img",51),n.Lc(14),n.Ub(),n.Vb(15,"td"),n.Lc(16),n.Ub(),n.Vb(17,"td"),n.Vb(18,"span",52),n.Lc(19),n.Ub(),n.Ub(),n.Vb(20,"td"),n.Lc(21),n.Ub(),n.Vb(22,"td"),n.Lc(23),n.Ub(),n.Vb(24,"td"),n.Lc(25),n.Ub(),n.Vb(26,"td"),n.Vb(27,"div",53),n.Lc(28),n.Ub(),n.Ub(),n.Ub()),2&t){const t=e.$implicit,i=n.hc(2);n.Cb(2),n.qc("routerLink","/branch/crm/oppurtunity-edit/",i.utilsService.encrypt(t.id),""),n.Cb(2),n.oc("ngIf",!i.storageService.get("isSingleBranchUser")),n.Cb(1),n.oc("ngIf",i.storageService.get("isSap")),n.Cb(2),n.Mc(t.opportunityNo),n.Cb(2),n.Mc(t.opportunityName),n.Cb(2),n.Oc("",t.partnerCode," - ",t.partnerName,""),n.Cb(2),n.oc("src",t.empImgUrl?t.empImgUrl:i.appConstants.DEFAULT_USER_ICON,n.Fc),n.Cb(1),n.Oc("\xa0",t.empCode," - ",t.empName,""),n.Cb(2),n.Nc(" ",t.stageDetails.length>0&&t.stageDetails[t.stageDetails.length-1]&&t.stageDetails[t.stageDetails.length-1].stageInfo&&t.stageDetails[t.stageDetails.length-1].stageInfo.length>0?t.stageDetails[t.stageDetails.length-1].stageInfo[0].stageName:""," "),n.Cb(2),n.oc("ngClass",i.appConstants.OPPORTUNITY_STATUS_COLOR_CLS[t.opportunityStatus]),n.Cb(1),n.Mc(t.statusName),n.Cb(2),n.Mc(t.startDate),n.Cb(2),n.Mc("0000-00-00"!==t.closingDate?t.closingDate:""),n.Cb(2),n.Mc(t.potentialAmount),n.Cb(2),n.oc("tooltip",t.distributionRulesValues),n.Cb(1),n.Nc(" ",t.distributionRulesValues,"")}}function Et(t,e){if(1&t){const t=n.Wb();n.Tb(0),n.Vb(1,"div",1),n.Vb(2,"span"),n.Lc(3,"S"),n.Ub(),n.Lc(4,"ales Opportunities - List "),n.Vb(5,"div",2),n.Jc(6,vt,4,0,"button",3),n.Vb(7,"button",4),n.Qb(8,"i",5),n.Vb(9,"span"),n.Lc(10,"Add Oppurtunity"),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(11,"div",6),n.Vb(12,"div",7),n.Vb(13,"div",8),n.Jc(14,Lt,6,3,"div",9),n.Ub(),n.Ub(),n.Vb(15,"div",8),n.Vb(16,"div",10),n.Vb(17,"label",11),n.Vb(18,"strong"),n.Lc(19,"From Date"),n.Ub(),n.Ub(),n.Vb(20,"p-calendar",12),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc().searchForm.fromDate=e}))("onSelect",(function(){return n.Dc(t),n.hc().resetListing()})),n.Ub(),n.Ub(),n.Vb(21,"div",10),n.Vb(22,"label",11),n.Vb(23,"strong"),n.Lc(24,"To Date"),n.Ub(),n.Ub(),n.Vb(25,"p-calendar",13),n.dc("ngModelChange",(function(e){return n.Dc(t),n.hc().searchForm.toDate=e}))("onSelect",(function(){return n.Dc(t),n.hc().resetListing()})),n.Ub(),n.Ub(),n.Ub(),n.Vb(26,"div",8),n.Vb(27,"div",14),n.Vb(28,"div",15),n.Vb(29,"p-table",16,17),n.dc("onLazyLoad",(function(e){return n.Dc(t),n.hc().getListing(e)})),n.Jc(31,Dt,61,37,"ng-template",18),n.Jc(32,Tt,29,18,"ng-template",19),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Sb()}if(2&t){const t=n.hc();n.Cb(6),n.oc("ngIf",t.screenAcl.download),n.Cb(8),n.oc("ngForOf",t.analyticsData),n.Cb(6),n.oc("ngModel",t.searchForm.fromDate)("monthNavigator",!0)("yearNavigator",!0)("yearRange",t.appConstants.PICKER_YEAR_RANGE)("dateFormat",t.appConstants.PICKER_DATE_FORMAT),n.Cb(5),n.oc("ngModel",t.searchForm.toDate)("monthNavigator",!0)("yearNavigator",!0)("yearRange",t.appConstants.PICKER_YEAR_RANGE)("dateFormat",t.appConstants.PICKER_DATE_FORMAT)("minDate",t.searchForm.fromDate),n.Cb(4),n.oc("value",t.listing.data)("lazy",!0)("paginator",!0)("rows",t.appConstants.TABLE_DEFAULT_ROWS)("totalRecords",t.listing.totalRecords)}}let At=(()=>{class t{constructor(t,e,i,s,o){this.utilsService=t,this.storageService=e,this.authGuardService=i,this.commonDataService=s,this.oppurtunityDataService=o,this.appConstants=r.h,this.screenAcl={},this.analyticsData=[],this.statusList=[],this.listingProperties={},this.listing={data:[],totalRecords:0},this.searchForm={sapId:"",opportunityNo:"",opportunityName:"",partnerName:"",empName:"",opportunityStatus:"1",startDate:"",closingDate:"",potentialAmount:"",fromDate:"",toDate:"",branchName:""}}ngOnInit(){if(this.screenAcl=this.authGuardService.getScreenAcl("1"),!this.screenAcl.view)return this.utilsService.showFailureMsg(r.h.ACL_UNAUTHORIZED_MSG),this.utilsService.goBack(),!1;this.getAutoSuggestionList("getOpportunityStatusList"),this.getAnalyticsData()}getListing(t){const e=Object.assign({},this.searchForm);e.fromDate=this.utilsService.getBackendDateFormat(this.searchForm.fromDate),e.toDate=this.utilsService.getBackendDateFormat(this.searchForm.toDate),e.startDate=this.utilsService.getBackendDateFormat(this.searchForm.startDate),e.closingDate=this.utilsService.getBackendDateFormat(this.searchForm.closingDate);const i=this.utilsService.dataTableParameterFormation(t,e);this.listingProperties=i,this.oppurtunityDataService.getList(i).subscribe(t=>{"SUCCESS"===t.status?(this.listing.data=t.results.searchResults,this.listing.totalRecords=t.results.totalRecords):this.utilsService.showFailureMsg(t)})}clearSearchForm(){this.searchForm={sapId:"",opportunityNo:"",opportunityName:"",partnerName:"",empName:"",opportunityStatus:"1",startDate:"",closingDate:"",potentialAmount:"",fromDate:"",toDate:"",branchName:""},this.resetListing()}resetListing(){this.dataTable.reset()}getAutoSuggestionList(t){this.commonDataService.getAutoSuggestionList(t).subscribe(e=>{"SUCCESS"===e.status?"getOpportunityStatusList"===t&&(this.statusList=e.results):this.utilsService.showFailureMsg(e)})}getAnalyticsData(){this.oppurtunityDataService.getAnalyticsData().subscribe(t=>{"SUCCESS"===t.status?(this.analyticsData=t.results,this.analyticsData=o.orderBy(this.analyticsData,["id"],["asc"])):this.utilsService.showFailureMsg(t)})}downloadAsExcel(){this.oppurtunityDataService.downloadAsExcel(this.listingProperties).subscribe(t=>{"SUCCESS"===t.status?this.utilsService.externalRedirect(t.fileUrl):this.utilsService.showFailureMsg(t)})}}return t.\u0275fac=function(e){return new(e||t)(n.Pb(r.g),n.Pb(r.f),n.Pb(r.a),n.Pb(a.l),n.Pb(a.H))},t.\u0275cmp=n.Jb({type:t,selectors:[["app-oppurtunity-list"]],viewQuery:function(t,e){var i;1&t&&n.Pc(ft,!0),2&t&&n.zc(i=n.ec())&&(e.dataTable=i.first)},decls:1,vars:1,consts:[[4,"ngIf"],[1,"page-title"],[1,"btn-group"],["class","btn btn-success btn-sm",3,"click",4,"ngIf"],["routerLink","/branch/crm/oppurtunity-add",1,"btn","btn-primary","btn-sm"],[1,"fa","fa-plus"],[1,"working-container"],[1,"analytics"],[1,"row"],["class","col-lg-2 col-md-3 col-sm-4 col-xs-12",4,"ngFor","ngForOf"],[1,"form-group","col-sm-3"],[1,"form-label"],["appendTo","body",3,"ngModel","monthNavigator","yearNavigator","yearRange","dateFormat","ngModelChange","onSelect"],["appendTo","body",3,"ngModel","monthNavigator","yearNavigator","yearRange","dateFormat","minDate","ngModelChange","onSelect"],[1,"col-12"],[1,"datatable-responsive"],[3,"value","lazy","paginator","rows","totalRecords","onLazyLoad"],["dataTable",""],["pTemplate","header"],["pTemplate","body"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"fa","fa-file-excel"],[1,"col-lg-2","col-md-3","col-sm-4","col-xs-12"],[1,"item"],[1,"name"],[1,"count",3,"ngClass"],[2,"width","100px"],["style","width:150px",3,"pSortableColumn",4,"ngIf"],["style","width:110px",3,"pSortableColumn",4,"ngIf"],[2,"width","140px",3,"pSortableColumn"],[3,"field"],[2,"width","200px",3,"pSortableColumn"],[2,"width","250px",3,"pSortableColumn"],[2,"width","130px"],[2,"width","120px",3,"pSortableColumn"],[2,"width","100px",3,"pSortableColumn"],[2,"width","200px"],["placement","top","container","body","tooltip","Press Enter key to search",1,"search"],[1,"clear-search",3,"click"],[1,"fa","fa-times"],["type","text",1,"form-control","form-control-sm",3,"ngModel","ngModelChange","keyup.enter"],[1,"form-control","form-control-sm",3,"ngModel","ngModelChange","change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","number",1,"form-control","form-control-sm",3,"ngModel","ngModelChange","keyup.enter"],[2,"width","150px",3,"pSortableColumn"],[2,"width","110px",3,"pSortableColumn"],[1,"form-control","form-control-sm",3,"ngModel","ngModelChange","keyup.enter"],[3,"value"],["placement","top","container","body","tooltip","Edit",1,"action","blue",3,"routerLink"],[1,"fa","fa-edit"],["height","20px",3,"src"],[1,"badge",3,"ngClass"],["placement","top","container","body",1,"single-line",3,"tooltip"]],template:function(t,e){1&t&&n.Jc(0,Et,33,18,"ng-container",0),2&t&&n.oc("ngIf",e.screenAcl.view)},directives:[c.m,s.e,c.l,b.a,u.m,u.o,d.c,l.b,c.k,d.b,d.a,m.a,u.b,u.t,u.p,u.v,u.q,s.g],styles:[""]}),t})();function Rt(t,e){1&t&&(n.Tb(0),n.Lc(1,"Add"),n.Sb())}function Pt(t,e){1&t&&(n.Tb(0),n.Lc(1,"Edit"),n.Sb())}function Mt(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.opportunityNo," ")}}function kt(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.opportunityName," ")}}function Ot(t,e){if(1&t&&(n.Vb(0,"option",62),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Mc(t.typeDescription)}}function wt(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.opportunityTypeId," ")}}function Jt(t,e){if(1&t&&(n.Vb(0,"div"),n.Lc(1),n.Vb(2,"small"),n.Lc(3),n.Ub(),n.Ub()),2&t){const t=e.item;n.Cb(1),n.Nc("",t.partnerName,"\xa0"),n.Cb(2),n.Nc("(",t.partnerCode,")")}}function xt(t,e){if(1&t){const t=n.Wb();n.Vb(0,"a",63),n.dc("click",(function(){return n.Dc(t),n.hc().bizRefreshFlag=!0})),n.Qb(1,"i",22),n.Ub()}}function Bt(t,e){if(1&t){const t=n.Wb();n.Vb(0,"a",21),n.dc("click",(function(){n.Dc(t);const e=n.hc();return e.getBpList(),e.bizRefreshFlag=!1})),n.Qb(1,"i",64),n.Ub()}}function Qt(t,e){if(1&t){const t=n.Wb();n.Vb(0,"span",65),n.dc("click",(function(){n.Dc(t);const e=n.hc();return e.popupExternalService.showDetailPopup("biz-partner",e.myForm1Data.businessPartnerId)})),n.Qb(1,"i",66),n.Ub()}}function _t(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.businessPartnerId," ")}}function qt(t,e){if(1&t&&(n.Vb(0,"div"),n.Lc(1),n.Ub(),n.Vb(2,"small"),n.Lc(3),n.Ub()),2&t){const t=e.item;n.Cb(1),n.Mc(t.contactName),n.Cb(2),n.Oc("",t.contactTypeName," / ",t.contactNumber,"")}}function jt(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.bpContactsId," ")}}function zt(t,e){1&t&&(n.Vb(0,"span",13),n.Lc(1,"*"),n.Ub())}function Kt(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.distributionRulesId," ")}}function Gt(t,e){if(1&t&&(n.Vb(0,"div"),n.Lc(1),n.Vb(2,"small"),n.Lc(3),n.Ub(),n.Ub()),2&t){const t=e.item;n.Cb(1),n.Nc("",t.employeeName,"\xa0"),n.Cb(2),n.Nc("(",t.empCode,")")}}function Wt(t,e){if(1&t){const t=n.Wb();n.Vb(0,"span",65),n.dc("click",(function(){n.Dc(t);const e=n.hc();return e.popupExternalService.showDetailPopup("employee",e.myForm1Data.empId)})),n.Qb(1,"i",66),n.Ub()}}function $t(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.startDate," ")}}function Yt(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.potentialAmount," ")}}function Ht(t,e){if(1&t&&(n.Vb(0,"option",62),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Mc(t.interestName)}}function Zt(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.levelOfInterestId," ")}}function Xt(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.industryId," ")}}function te(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.informationSourceId," ")}}function ee(t,e){if(1&t){const t=n.Wb();n.Vb(0,"a",76),n.dc("click",(function(){n.Dc(t);const e=n.hc().index;return n.hc().removeStageFields(e)})),n.Qb(1,"i",77),n.Ub()}}function ie(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc().index,e=n.hc();n.Cb(1),n.Nc(" ",e.myFormErrors1.stageListArray[t].startDate," ")}}function se(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc().index,e=n.hc();n.Cb(1),n.Nc(" ",e.myFormErrors1.stageListArray[t].closingDate," ")}}function oe(t,e){if(1&t&&(n.Vb(0,"div"),n.Lc(1),n.Vb(2,"small"),n.Lc(3),n.Ub(),n.Ub()),2&t){const t=e.item;n.Cb(1),n.Nc("",t.employeeName,"\xa0"),n.Cb(2),n.Nc("(",t.empCode,")")}}function re(t,e){if(1&t){const t=n.Wb();n.Vb(0,"span",65),n.dc("click",(function(){n.Dc(t);const e=n.hc().index,i=n.hc();return i.popupExternalService.showDetailPopup("employee",i.myForm1Data.stageListArray[e].empId)})),n.Qb(1,"i",66),n.Ub()}}function ne(t,e){if(1&t&&(n.Vb(0,"option",62),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Oc("",t.stageNumber," - ",t.stageName," ")}}function ae(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc().index,e=n.hc();n.Cb(1),n.Nc(" ",e.myFormErrors1.stageListArray[t].stageId," ")}}function ce(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc().index,e=n.hc();n.Cb(1),n.Nc(" ",e.myFormErrors1.stageListArray[t].stagePercentage," ")}}function be(t,e){if(1&t&&(n.Vb(0,"option",62),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Mc(t.screenName)}}function ue(t,e){if(1&t){const t=n.Wb();n.Vb(0,"a",21),n.dc("click",(function(){n.Dc(t);const e=n.hc().index;return n.hc().navigateToDocument(e)})),n.Qb(1,"i",22),n.Ub()}}function de(t,e){if(1&t){const t=n.Wb();n.Vb(0,"tr",67),n.Vb(1,"td"),n.Jc(2,ee,2,0,"a",68),n.Ub(),n.Vb(3,"td"),n.Vb(4,"p-calendar",69),n.dc("onSelect",(function(){n.Dc(t);const i=e.index;return n.hc().onStageStartDateChange(i)})),n.Ub(),n.Jc(5,ie,2,1,"div",15),n.Ub(),n.Vb(6,"td"),n.Qb(7,"p-calendar",70),n.Jc(8,se,2,1,"div",15),n.Ub(),n.Vb(9,"td"),n.Vb(10,"div",31),n.Vb(11,"ng-select",71),n.Jc(12,oe,4,2,"ng-template",24),n.Ub(),n.Jc(13,re,2,0,"span",27),n.Ub(),n.Ub(),n.Vb(14,"td"),n.Vb(15,"select",72),n.dc("change",(function(i){n.Dc(t);const s=e.index;return n.hc().setStagePercentage(s,i.target.value)})),n.Vb(16,"option",19),n.Lc(17,"--SELECT--"),n.Ub(),n.Jc(18,ne,2,3,"option",20),n.Ub(),n.Jc(19,ae,2,1,"div",15),n.Ub(),n.Vb(20,"td"),n.Lc(21),n.Jc(22,ce,2,1,"div",15),n.Ub(),n.Vb(23,"td"),n.Vb(24,"div",17),n.Qb(25,"ng-select",73),n.Ub(),n.Ub(),n.Vb(26,"td"),n.Vb(27,"select",74),n.dc("change",(function(){n.Dc(t);const i=e.index;return n.hc().getDocumentList(i)})),n.Vb(28,"option",19),n.Lc(29,"--SELECT--"),n.Ub(),n.Jc(30,be,2,2,"option",20),n.Ub(),n.Ub(),n.Vb(31,"td"),n.Vb(32,"div",17),n.Qb(33,"ng-select",75),n.Jc(34,ue,2,0,"a",26),n.Ub(),n.Ub(),n.Ub()}if(2&t){const t=e.index,i=n.hc();n.oc("formGroupName",t),n.Cb(2),n.oc("ngIf",t==i.myForm1.controls.stageListArray.controls.length-1),n.Cb(2),n.oc("monthNavigator",!0)("yearNavigator",!0)("yearRange",i.appConstants.PICKER_YEAR_RANGE)("dateFormat",i.appConstants.PICKER_DATE_FORMAT),n.Cb(1),n.oc("ngIf",i.myFormErrors1.stageListArray[t].startDate),n.Cb(2),n.oc("monthNavigator",!0)("yearNavigator",!0)("yearRange",i.appConstants.PICKER_YEAR_RANGE)("dateFormat",i.appConstants.PICKER_DATE_FORMAT)("minDate",i.myForm1Data.stageListArray[t].startDate),n.Cb(1),n.oc("ngIf",i.myFormErrors1.stageListArray[t].closingDate),n.Cb(3),n.oc("items",i.salesEmployeeList)("multiple",!1),n.Cb(2),n.oc("ngIf",i.myForm1Data.stageListArray[t].empId),n.Cb(5),n.oc("ngForOf",i.stageList),n.Cb(1),n.oc("ngIf",i.myFormErrors1.stageListArray[t].stageId),n.Cb(2),n.Nc(" ",i.myForm1Data.stageListArray[t].stagePercentage," "),n.Cb(1),n.oc("ngIf",i.myFormErrors1.stageListArray[t].stagePercentage),n.Cb(3),n.oc("items",i.activityNoList)("multiple",!1),n.Cb(5),n.oc("ngForOf",i.documentTypeList),n.Cb(3),n.oc("items",i.myForm1Data.stageListArray[t].documentList)("multiple",!1),n.Cb(1),n.oc("ngIf",!i.myForm1Data.stageListArray[t].documentNoFlag)}}function le(t,e){if(1&t&&(n.Vb(0,"option",62),n.Lc(1),n.Ub()),2&t){const t=e.$implicit;n.oc("value",t.id),n.Cb(1),n.Mc(t.name)}}function me(t,e){if(1&t&&(n.Vb(0,"div",61),n.Lc(1),n.Ub()),2&t){const t=n.hc();n.Cb(1),n.Nc(" ",t.myFormErrors1.opportunityStatus," ")}}function pe(t,e){if(1&t){const t=n.Wb();n.Vb(0,"button",78),n.dc("click",(function(){return n.Dc(t),n.hc().saveUpdate()})),n.Qb(1,"i",79),n.Vb(2,"span"),n.Lc(3,"Save"),n.Ub(),n.Ub()}}function he(t,e){if(1&t){const t=n.Wb();n.Vb(0,"button",3),n.dc("click",(function(){return n.Dc(t),n.hc().clearForm()})),n.Qb(1,"i",80),n.Vb(2,"span"),n.Lc(3,"Clear"),n.Ub(),n.Ub()}}function ge(t,e){if(1&t){const t=n.Wb();n.Vb(0,"button",78),n.dc("click",(function(){return n.Dc(t),n.hc().saveUpdate()})),n.Qb(1,"i",64),n.Vb(2,"span"),n.Lc(3,"Update"),n.Ub(),n.Ub()}}function ye(t,e){1&t&&(n.Vb(0,"button",81),n.Qb(1,"i",82),n.Vb(2,"span"),n.Lc(3,"Cancel"),n.Ub(),n.Ub())}function fe(t,e){1&t&&(n.Vb(0,"div",85),n.Vb(1,"span",86),n.Lc(2,"Note:"),n.Ub(),n.Lc(3," You are unauthorized to "),n.Vb(4,"strong"),n.Lc(5,"update"),n.Ub(),n.Lc(6," this transaction! "),n.Ub())}function ve(t,e){1&t&&(n.Vb(0,"div",85),n.Vb(1,"span",86),n.Lc(2,"Note:"),n.Ub(),n.Lc(3," Cannot update "),n.Vb(4,"strong"),n.Lc(5,"In-Active"),n.Ub(),n.Lc(6," / "),n.Vb(7,"strong"),n.Lc(8,"Closed"),n.Ub(),n.Lc(9," transactions! "),n.Ub())}function Le(t,e){if(1&t&&(n.Vb(0,"div",83),n.Vb(1,"div"),n.Vb(2,"strong"),n.Lc(3,"Created By:"),n.Ub(),n.Lc(4),n.Ub(),n.Jc(5,fe,7,0,"div",84),n.Jc(6,ve,10,0,"div",84),n.Ub()),2&t){const t=n.hc();n.Cb(4),n.Nc(" ",t.editCreatedName,""),n.Cb(1),n.oc("ngIf",!t.screenAcl.update),n.Cb(1),n.oc("ngIf","1"!==t.editStatusId)}}function Ce(t,e){1&t&&(n.Vb(0,"div",83),n.Vb(1,"span",86),n.Lc(2,"Note:"),n.Ub(),n.Lc(3," You are unauthorized to "),n.Vb(4,"strong"),n.Lc(5,"add"),n.Ub(),n.Lc(6," this transaction!. "),n.Ub())}let Se=(()=>{class t{constructor(t,e,i,s,o,n,a,c,b){this.utilsService=t,this.storageService=e,this.authGuardService=i,this.commonDataService=s,this.oppurtunityDataService=o,this.branchUtilsService=n,this.popupExternalService=a,this.formBuilder=c,this.activatedRoute=b,this.appConstants=r.h,this.screenAcl={},this.threatLevelName="",this.bizRefreshFlag=!1,this.opportunityTypeList=[],this.businessPartnerList=[],this.bpContactList=[],this.distributionList=[],this.salesEmployeeList=[],this.levelOfInterestList=[],this.industryList=[],this.infoSourceList=[],this.competitorList=[],this.reasonList=[],this.statusList=[],this.stageList=[],this.documentTypeList=[],this.activityNoList=[],this.myForm1Data={},this.myFormErrors1={opportunityNo:"",opportunityName:"",opportunityTypeId:"",businessPartnerId:"",bpContactsId:"",distributionRulesId:"",startDate:"",closingDate:"",potentialAmount:"",levelOfInterestId:"",industryId:"",informationSourceId:"",competitorId:"",opportunityStatus:"",reasonId:"",remarks:"",stageListArray:[]},this.myFormValidationMsgs1={opportunityNo:{required:"Opportunity No is required"},opportunityName:{required:"Opportunity Name is required"},opportunityTypeId:{required:"Opportunity Type is required"},businessPartnerId:{required:"Business Partner is required"},bpContactsId:{required:"Business Partner Contact is required"},distributionRulesId:{required:"Dist.Rules is required"},startDate:{required:"Start Date is required"},potentialAmount:{required:"Potential Amount is required",min:"Minimum should be greater than 0"},industryId:{required:"Industry is required"},informationSourceId:{required:"Information Source is required"},opportunityStatus:{required:"Status is required"},stageListArray:{startDate:{required:"Start Date is required"},closingDate:{required:"Closing Date is required"},stageId:{required:"Stage is required"},stagePercentage:{required:"Percentage is required"}}}}ngOnInit(){if(this.screenAcl=this.authGuardService.getScreenAcl("1"),!this.screenAcl.view)return this.utilsService.showFailureMsg(r.h.ACL_UNAUTHORIZED_MSG),this.utilsService.goBack(),!1;this.initializeForm1(),this.initializeSubscriptions(),this.getAutoSuggestionList("getOpportunityTypeList"),this.getAutoSuggestionList("getLevelofInterestList"),this.getAutoSuggestionList("getOpportunityStatusList"),this.getDocumentTypeList()}ngAfterViewInit(){this.attachmentsComponent.loadAttachments(this.inputEditId),this.udfViewerComponent.getFields(this.inputEditId)}initializeSubscriptions(){this.activatedRoute.params.subscribe(t=>{t.id?(this.inputEditId=this.utilsService.decrypt(t.id),this.get()):(this.getBpList(),this.getAutoSuggestionList("getIndustryList"),this.getAutoSuggestionList("getInformationSourceList"),this.getAutoSuggestionList("getCompetitorList"),this.getAutoSuggestionList("getReasonList"),this.getAutoSuggestionList("getStageList"),this.getSalesEmployeeList(),this.getDistributionList())}),this.branchUtilsService.actionSaveUpdate.subscribe(t=>{switch(t.triggerType){case"industry":this.getAutoSuggestionList("getIndustryList");break;case"info-source":this.getAutoSuggestionList("getInformationSourceList");break;case"competitor":this.getAutoSuggestionList("getCompetitorList");break;case"reason":this.getAutoSuggestionList("getReasonList");break;case"opportunity-type":this.getAutoSuggestionList("getOpportunityTypeList")}})}initializeForm1(){this.myForm1=this.formBuilder.group({opportunityNo:[{value:"AUTO",disabled:!0},[u.u.required]],opportunityName:["",[u.u.required]],opportunityTypeId:["",[u.u.required]],businessPartnerId:[null,[u.u.required]],bpContactsId:[null,[u.u.required]],distributionRulesId:[null],empId:[null],startDate:["",[u.u.required]],closingDate:[{value:"",disabled:!0}],potentialAmount:["",[u.u.required,u.u.min(1)]],levelOfInterestId:[""],industryId:[null,[u.u.required]],informationSourceId:[null,[u.u.required]],competitorId:[null],opportunityStatus:["1",[u.u.required]],reasonId:[{value:null,disabled:!0}],remarks:[""],deletedStageChildIds:[[]],stageListArray:this.formBuilder.array([this.initStageFields()])}),this.myForm1.valueChanges.subscribe(t=>{this.utilsService.validation(this.myForm1,this.myFormErrors1,this.myFormValidationMsgs1),this.myForm1Data=this.myForm1.getRawValue()}),this.myForm1Data=this.myForm1.getRawValue(),this.storageService.get("distRulesMode")&&this.myForm1.controls.distributionRulesId.setValidators(u.u.required)}addStageFields(t){const e=this.myForm1.controls.stageListArray;if(e.length>0&&!t&&!e.at(e.length-1).valid)return this.utilsService.showFailureMsg("Complete the validation for the previous stage to proceed!"),!1;e.push(this.initStageFields(t)),this.disableStagePrevFields()}initStageFields(t){this.myFormErrors1.stageListArray.push({startDate:"",closingDate:"",stageId:"",stagePercentage:""});const e={startDate:["",[u.u.required]],closingDate:["",[u.u.required]],empId:[null],stageId:["",[u.u.required]],stagePercentage:["",[u.u.required]],activityId:[null],documentTypeId:[""],documentId:[null],documentList:[[]],documentNoFlag:[!1],id:[""]};return t&&(this.utilsService.updateObject(e,"startDate",t.startDate,"date"),this.utilsService.updateObject(e,"closingDate",t.closingDate,"date"),this.utilsService.updateObject(e,"empId",t.empId),this.utilsService.updateObject(e,"stageId",t.stageId),this.utilsService.updateObject(e,"stagePercentage",t.stagePercentage),this.utilsService.updateObject(e,"activityId",t.activityId),this.utilsService.updateObject(e,"documentTypeId",t.documentTypeId),this.utilsService.updateObject(e,"documentId",t.documentId),this.utilsService.updateObject(e,"id",t.id)),this.formBuilder.group(e)}removeStageFields(t){const e=this.myForm1Data.stageListArray[t].id;if(e){const t=this.myForm1Data.deletedStageChildIds;t.push(e),this.myForm1.patchValue({deletedStageChildIds:t})}this.myForm1.controls.stageListArray.removeAt(t),this.disableStagePrevFields()}disableStagePrevFields(){const t=this.myForm1.controls.stageListArray;t.length>0&&(t.disable(),t.at(t.length-1).enable())}saveUpdate(){if(!this.myForm1.valid||!this.udfViewerComponent.valid())return this.utilsService.validation(this.myForm1,this.myFormErrors1,this.myFormValidationMsgs1,!0),this.udfViewerComponent.checkValidations(),!1;const t=new Set,e=[];if(this.myForm1Data.stageListArray.forEach(i=>{t.add(i.stageId),e.push(i.stageId)}),e.length!==t.size)return this.utilsService.showFailureMsg("Cannot duplicate stage"),!1;const i={opportunityNo:this.myForm1Data.opportunityNo,opportunityName:this.myForm1Data.opportunityName,opportunityTypeId:this.myForm1Data.opportunityTypeId,businessPartnerId:this.myForm1Data.businessPartnerId,bpContactsId:this.myForm1Data.bpContactsId,distributionRulesId:Array.isArray(this.myForm1Data.distributionRulesId)?this.myForm1Data.distributionRulesId.join(","):"",empId:this.myForm1Data.empId,startDate:this.utilsService.getBackendDateFormat(this.myForm1Data.startDate),closingDate:this.utilsService.getBackendDateFormat(this.myForm1Data.closingDate),potentialAmount:this.myForm1Data.potentialAmount,levelOfInterestId:this.myForm1Data.levelOfInterestId,industryId:this.myForm1Data.industryId,informationSourceId:this.myForm1Data.informationSourceId,competitorId:this.myForm1Data.competitorId,opportunityStatus:this.myForm1Data.opportunityStatus,reasonId:this.myForm1Data.reasonId,remarks:this.myForm1Data.remarks,opportunityStagesId:this.myForm1Data.opportunityStagesId,stageListArray:[],udfFields:JSON.stringify(this.udfViewerComponent.getFormValues())};let s;this.myForm1Data.stageListArray.forEach(t=>{const e={startDate:this.utilsService.getBackendDateFormat(t.startDate),closingDate:this.utilsService.getBackendDateFormat(t.closingDate),empId:t.empId,stageId:t.stageId,stagePercentage:t.stagePercentage,activityId:t.activityId,documentTypeId:t.documentTypeId,documentId:t.documentId,id:t.id};i.stageListArray.push(e)}),this.inputEditId?(s="update",i.id=this.inputEditId,i.deletedStageChildIds=this.myForm1Data.deletedStageChildIds):s="save",this.oppurtunityDataService[s](i).subscribe(t=>{"SUCCESS"===t.status?(this.utilsService.showSuccessMsg(t),this.attachmentsComponent.save("save"===s?t.sId:this.inputEditId)):this.utilsService.showFailureMsg(t)})}redirectToList(){this.utilsService.redirect("/branch/crm/oppurtunity-list")}get(){this.oppurtunityDataService.get(this.inputEditId).subscribe(t=>{if("SUCCESS"===t.status){const e=t.results,i={};this.utilsService.updateObject(i,"opportunityNo",e.opportunityNo),this.utilsService.updateObject(i,"opportunityName",e.opportunityName),this.utilsService.updateObject(i,"opportunityTypeId",e.opportunityTypeId),this.utilsService.updateObject(i,"businessPartnerId",e.businessPartnerId),this.utilsService.updateObject(i,"bpContactsId",e.bpContactsId),this.utilsService.isEmpty(e.distributionRulesId)||(i.distributionRulesId=this.branchUtilsService.distRulesRemoveZeroPatternOnEdit(e.distributionRulesId)),this.utilsService.updateObject(i,"empId",e.empId),this.utilsService.updateObject(i,"startDate",e.startDate,"date"),this.utilsService.updateObject(i,"closingDate",e.closingDate,"date"),this.utilsService.updateObject(i,"potentialAmount",e.potentialAmount),this.utilsService.updateObject(i,"levelOfInterestId",e.levelOfInterestId),this.utilsService.updateObject(i,"industryId",e.industryId),this.utilsService.updateObject(i,"informationSourceId",e.informationSourceId),this.utilsService.updateObject(i,"competitorId",e.competitorId),this.utilsService.updateObject(i,"opportunityStatus",e.opportunityStatus),this.utilsService.updateObject(i,"reasonId",e.reasonId),this.utilsService.updateObject(i,"remarks",e.remarks),this.utilsService.updateObject(i,"opportunityStagesId",e.opportunityStagesId),this.myForm1.patchValue(i),this.getBpList(!0,e.businessPartnerInfo),this.getAutoSuggestionList("getIndustryList",e.industryInfo),this.getAutoSuggestionList("getInformationSourceList",e.infoSourceInfo),this.getAutoSuggestionList("getCompetitorList",e.competitorInfo),this.getAutoSuggestionList("getReasonList",e.reasonInfo),this.getDistributionList(e.distributionRulesInfo),this.getBpContactList(!0,e.bpContactsInfo),this.removeStageFields(0);const s=[],o=[e.empInfo[0]],r=[];e.stageListArray.forEach((t,e)=>{this.addStageFields(t),t.stageInfo[0]&&s.push(t.stageInfo[0]),t.empInfo[0]&&o.push(t.empInfo[0]),t.activityNumberInfo[0]&&r.push(t.activityNumberInfo[0]),this.getDocumentList(e,!0,t.documentInfo)}),this.getAutoSuggestionList("getStageList",s),this.getSalesEmployeeList(o),this.getActivityNoList(r),this.onStatusChange(!0),this.disableStagePrevFields(),this.editStatusId=e.opportunityStatus,this.editCreatedName=e.createdByInfo[0].employeeName,"1"===this.editStatusId?this.myForm1.controls.businessPartnerId.disable():this.myForm1.enable()}else this.utilsService.showFailureMsg(t)})}clearForm(){this.initializeForm1()}setThreatLevel(t){const e=o.findIndex(this.competitorList,{id:t});this.threatLevelName=e>=0?this.competitorList[e].threatLevelName:""}setStagePercentage(t,e){const i=o.findIndex(this.stageList,{id:e});let s="";i>=0&&(s=this.stageList[i].closePercentage),this.myForm1.controls.stageListArray.at(t).patchValue({stagePercentage:s})}onStatusChange(t){"1"===this.myForm1Data.opportunityStatus?(t||this.myForm1.patchValue({closingDate:""}),this.myForm1.patchValue({reasonId:null}),this.myForm1.controls.reasonId.disable(),this.myForm1.controls.closingDate.disable()):(t||this.myForm1.patchValue({closingDate:this.utilsService.getPickerDateFormat(new Date)}),this.myForm1.controls.reasonId.enable(),this.myForm1.controls.closingDate.enable())}onStartDateChange(){this.myForm1.patchValue({closingDate:""})}onStageStartDateChange(t){this.myForm1.controls.stageListArray.at(t).patchValue({closingDate:""})}resetDocument(){const t=this.myForm1.controls.stageListArray;for(const e of t.controls)e.patchValue({documentTypeId:"",documentId:null,documentList:[]})}onDistRuleAdd(){this.branchUtilsService.distRulesCheckUnique(this.distributionList,this.myForm1,"distributionRulesId")}getAutoSuggestionList(t,e){this.commonDataService.getAutoSuggestionList(t).subscribe(i=>{"SUCCESS"===i.status?(this.utilsService.ifNotPushToList(i.results,e),"getOpportunityTypeList"===t?this.opportunityTypeList=i.results:"getLevelofInterestList"===t?this.levelOfInterestList=i.results:"getIndustryList"===t?this.industryList=i.results:"getInformationSourceList"===t?this.infoSourceList=i.results:"getCompetitorList"===t?(this.competitorList=i.results,Array.isArray(e)&&this.setThreatLevel(e[0].id)):"getReasonList"===t?this.reasonList=i.results:"getOpportunityStatusList"===t?(this.inputEditId||(i.results=i.results.filter(t=>"1"===t.id)),this.statusList=i.results):"getStageList"===t&&(this.stageList=i.results)):this.utilsService.showFailureMsg(i)})}getBpList(t,e){this.commonDataService.getBusinessPartnerList([1,3]).subscribe(t=>{"SUCCESS"===t.status?(this.utilsService.ifNotPushToList(t.results,e),this.businessPartnerList=t.results.map(t=>(t.searchText=t.partnerName+" - "+t.partnerCode,t))):this.utilsService.showFailureMsg(t)})}getSalesEmployeeList(t){this.commonDataService.getEmployeeList(1).subscribe(e=>{"SUCCESS"===e.status?(this.utilsService.ifNotPushToList(e.results,t),this.salesEmployeeList=e.results.map(t=>(t.searchText=t.employeeName+" - "+t.empCode,t))):this.utilsService.showFailureMsg(e)})}getBpContactList(t,e){this.bpContactList=[],this.branchUtilsService.getBpContactListAndSet(this.myForm1,"bpContactsId","businessPartnerId",t,e).subscribe(t=>{this.bpContactList=t})}getDocumentList(t,e,i){const s=this.myForm1.controls.stageListArray.at(t),o=this.myForm1Data.stageListArray[t].documentTypeId,r=this.myForm1Data.businessPartnerId;if(s.patchValue({documentList:[]}),e||s.patchValue({documentId:null}),!r)return this.utilsService.showFailureMsg("Select business partner to get the appropriate documents!"),s.patchValue({documentTypeId:""}),!1;this.utilsService.isEmpty(o)||this.commonDataService.getDocumentList(o,r).subscribe(t=>{"SUCCESS"===t.status?(s.patchValue({documentList:t.results}),e&&this.utilsService.ifNotPushToList(s.controls.documentList.value,i)):this.utilsService.showFailureMsg(t)})}getActivityNoList(t){if(!this.myForm1Data.businessPartnerId)return this.activityNoList=[],!1;this.commonDataService.getDocumentList(4,this.myForm1Data.businessPartnerId).subscribe(e=>{"SUCCESS"===e.status?(this.utilsService.ifNotPushToList(e.results,t),this.activityNoList=e.results):this.utilsService.showFailureMsg(e)})}getDocumentTypeList(){this.branchUtilsService.getDocumentTypeListBasedOnScreen("opportunity").subscribe(t=>{this.documentTypeList=t})}getDistributionList(t){this.commonDataService.getDistributionList(!0).subscribe(e=>{"SUCCESS"===e.status?(this.utilsService.ifNotPushToList(e.results,t),this.distributionList=e.results):this.utilsService.showFailureMsg(e)})}navigateToDocument(t){const e=this.myForm1.controls.stageListArray.at(t);if(e.value.documentTypeId)switch(e.value.documentTypeId){case"2":this.utilsService.externalRedirect("#/branch/sales/sales-txn-add/salesQuote",!0);break;case"3":this.utilsService.externalRedirect("#/branch/sales/sales-txn-add/salesOrder",!0)}else this.utilsService.showFailureMsg("Select document type to continue!")}onKeydownHandler(t){t.ctrlKey&&"s"===t.key.toLowerCase()&&(this.inputEditId&&"1"===this.editStatusId||!this.inputEditId)&&(this.saveUpdate(),t.preventDefault())}}return t.\u0275fac=function(e){return new(e||t)(n.Pb(r.g),n.Pb(r.f),n.Pb(r.a),n.Pb(a.l),n.Pb(a.H),n.Pb(P.a),n.Pb(M.a),n.Pb(u.e),n.Pb(s.a))},t.\u0275cmp=n.Jb({type:t,selectors:[["app-oppurtunity-add"]],viewQuery:function(t,e){var i;1&t&&(n.Pc(A.a,!0),n.Pc(R.a,!0)),2&t&&(n.zc(i=n.ec())&&(e.attachmentsComponent=i.first),n.zc(i=n.ec())&&(e.udfViewerComponent=i.first))},hostBindings:function(t,e){1&t&&n.dc("keydown",(function(t){return e.onKeydownHandler(t)}),!1,n.Bc)},decls:231,vars:58,consts:[[1,"page-title"],[4,"ngIf"],[1,"btn-group"],[1,"btn","btn-secondary","btn-sm",3,"click"],[1,"fa","fa-arrow-left"],[1,"working-container",3,"formGroup"],[1,"box"],[1,"box-header"],[1,"fa","fa-angle-right"],[1,"box-body","box-form"],[1,"row"],[1,"form-group","col-sm-3"],[1,"form-label"],[1,"mandatory"],["type","text","formControlName","opportunityNo",1,"form-control","form-control-sm"],["class","validation-error",4,"ngIf"],["type","text","formControlName","opportunityName",1,"form-control","form-control-sm"],[1,"action-control"],["formControlName","opportunityTypeId",1,"form-control","form-control-sm"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"click"],[1,"fa","fa-plus"],["formControlName","businessPartnerId","bindLabel","searchText","bindValue","id","placeholder","--SELECT--",3,"items","multiple","clear","change"],["ng-option-tmp",""],["target","_blank","routerLink","/branch/bp/biz-partner-add",3,"click",4,"ngIf"],[3,"click",4,"ngIf"],["class","info-icon","container","body","tooltip","View Details",3,"click",4,"ngIf"],["formControlName","bpContactsId","bindLabel","contactName","bindValue","id","placeholder","--SELECT--",3,"items","multiple"],["class","mandatory",4,"ngIf"],["formControlName","distributionRulesId","bindLabel","distributionName","bindValue","id","placeholder","--SELECT--","groupBy","dimensionDescription",3,"items","multiple","add"],[1,"position-relative"],["formControlName","empId","bindLabel","searchText","bindValue","id","placeholder","--SELECT--",3,"items","multiple"],["formControlName","startDate",3,"monthNavigator","yearNavigator","yearRange","dateFormat","onSelect"],["formControlName","closingDate",3,"monthNavigator","yearNavigator","yearRange","dateFormat","minDate"],["type","number","formControlName","potentialAmount",1,"form-control","form-control-sm"],["formControlName","levelOfInterestId",1,"form-control","form-control-sm"],["formControlName","industryId","bindLabel","industryName","bindValue","id","placeholder","--SELECT--",3,"items","multiple"],["formControlName","informationSourceId","bindLabel","sourceDescription","bindValue","id","placeholder","--SELECT--",3,"items","multiple"],[1,"box-body","box-table"],[1,"table-responsive"],[1,"table","table-striped","table-bordered"],[2,"min-width","120px"],[2,"min-width","150px"],[2,"min-width","100px"],["formArrayName","stageListArray"],[3,"formGroupName",4,"ngFor","ngForOf"],["colspan","9"],[1,"btn","btn-success","btn-sm",3,"click"],["formControlName","competitorId","bindLabel","competitorName","bindValue","id","placeholder","--SELECT--",3,"items","multiple","change"],["readonly","",1,"form-control","form-control-sm",3,"value"],["formControlName","opportunityStatus",1,"form-control","form-control-sm",3,"change"],["formControlName","reasonId","bindLabel","reasonDescription","bindValue","id","placeholder","--SELECT--",3,"items","multiple"],["rows","2","formControlName","remarks",1,"form-control","form-control-sm"],[3,"type"],[3,"type","doSuccess"],[1,"btn-group","text-right"],["class","btn btn-primary btn-sm",3,"click",4,"ngIf"],["class","btn btn-secondary btn-sm",3,"click",4,"ngIf"],["class","btn btn-secondary btn-sm","routerLink","/branch/crm/oppurtunity-list",4,"ngIf"],["class","alert alert-info mt-3",4,"ngIf"],[1,"validation-error"],[3,"value"],["target","_blank","routerLink","/branch/bp/biz-partner-add",3,"click"],[1,"fa","fa-redo-alt"],["container","body","tooltip","View Details",1,"info-icon",3,"click"],[1,"fa","fa-info-circle"],[3,"formGroupName"],["class","action red",3,"click",4,"ngIf"],["formControlName","startDate","appendTo","body",3,"monthNavigator","yearNavigator","yearRange","dateFormat","onSelect"],["formControlName","closingDate","appendTo","body",3,"monthNavigator","yearNavigator","yearRange","dateFormat","minDate"],["formControlName","empId","bindLabel","searchText","bindValue","id","placeholder","--SELECT--","appendTo","body",3,"items","multiple"],["formControlName","stageId",1,"form-control","form-control-sm",3,"change"],["formControlName","activityId","bindLabel","documentNumber","bindValue","id","placeholder","--SELECT--","appendTo","body",3,"items","multiple"],["formControlName","documentTypeId",1,"form-control","form-control-sm",3,"change"],["formControlName","documentId","bindLabel","documentNumber","bindValue","id","placeholder","--SELECT--","appendTo","body",3,"items","multiple"],[1,"action","red",3,"click"],[1,"fa","fa-minus-circle"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"fa","fa-save"],[1,"fa","fa-broom"],["routerLink","/branch/crm/oppurtunity-list",1,"btn","btn-secondary","btn-sm"],[1,"fa","fa-times"],[1,"alert","alert-info","mt-3"],["class","mt-2",4,"ngIf"],[1,"mt-2"],[1,"badge","badge-danger"]],template:function(t,e){1&t&&(n.Vb(0,"div",0),n.Vb(1,"span"),n.Lc(2,"S"),n.Ub(),n.Lc(3,"ales Opportunities - "),n.Jc(4,Rt,2,0,"ng-container",1),n.Jc(5,Pt,2,0,"ng-container",1),n.Vb(6,"div",2),n.Vb(7,"button",3),n.dc("click",(function(){return e.utilsService.goBack()})),n.Qb(8,"i",4),n.Vb(9,"span"),n.Lc(10,"Back"),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(11,"div",5),n.Vb(12,"div",6),n.Vb(13,"div",7),n.Qb(14,"i",8),n.Lc(15,"Opportunity Info "),n.Ub(),n.Vb(16,"div",9),n.Vb(17,"div",10),n.Vb(18,"div",11),n.Vb(19,"label",12),n.Lc(20,"Opportunity Number"),n.Vb(21,"span",13),n.Lc(22,"*"),n.Ub(),n.Ub(),n.Qb(23,"input",14),n.Jc(24,Mt,2,1,"div",15),n.Ub(),n.Vb(25,"div",11),n.Vb(26,"label",12),n.Lc(27,"Opportunity Name"),n.Vb(28,"span",13),n.Lc(29,"*"),n.Ub(),n.Ub(),n.Qb(30,"input",16),n.Jc(31,kt,2,1,"div",15),n.Ub(),n.Vb(32,"div",11),n.Vb(33,"label",12),n.Lc(34,"Opportunity Type"),n.Vb(35,"span",13),n.Lc(36,"*"),n.Ub(),n.Ub(),n.Vb(37,"div",17),n.Vb(38,"select",18),n.Vb(39,"option",19),n.Lc(40,"--SELECT--"),n.Ub(),n.Jc(41,Ot,2,2,"option",20),n.Ub(),n.Vb(42,"span"),n.Vb(43,"a",21),n.dc("click",(function(){return e.popupExternalService.showAddPopup("opportunity-type")})),n.Qb(44,"i",22),n.Ub(),n.Ub(),n.Ub(),n.Jc(45,wt,2,1,"div",15),n.Ub(),n.Vb(46,"div",11),n.Vb(47,"label",12),n.Lc(48,"Business Partner Name"),n.Vb(49,"span",13),n.Lc(50,"*"),n.Ub(),n.Ub(),n.Vb(51,"div",17),n.Vb(52,"ng-select",23),n.dc("clear",(function(){return e.getBpContactList()}))("change",(function(){return e.getBpContactList(),e.resetDocument(),e.getActivityNoList()})),n.Jc(53,Jt,4,2,"ng-template",24),n.Ub(),n.Vb(54,"span"),n.Jc(55,xt,2,0,"a",25),n.Jc(56,Bt,2,0,"a",26),n.Ub(),n.Jc(57,Qt,2,0,"span",27),n.Ub(),n.Jc(58,_t,2,1,"div",15),n.Ub(),n.Vb(59,"div",11),n.Vb(60,"label",12),n.Lc(61,"Business Partner Contact"),n.Vb(62,"span",13),n.Lc(63,"*"),n.Ub(),n.Ub(),n.Vb(64,"ng-select",28),n.Jc(65,qt,4,3,"ng-template",24),n.Ub(),n.Jc(66,jt,2,1,"div",15),n.Ub(),n.Vb(67,"div",11),n.Vb(68,"label",12),n.Lc(69,"Distribution Rules"),n.Jc(70,zt,2,0,"span",29),n.Ub(),n.Vb(71,"ng-select",30),n.dc("add",(function(){return e.onDistRuleAdd()})),n.Ub(),n.Jc(72,Kt,2,1,"div",15),n.Ub(),n.Vb(73,"div",11),n.Vb(74,"label",12),n.Lc(75,"Sales Employee"),n.Ub(),n.Vb(76,"div",31),n.Vb(77,"ng-select",32),n.Jc(78,Gt,4,2,"ng-template",24),n.Ub(),n.Jc(79,Wt,2,0,"span",27),n.Ub(),n.Ub(),n.Vb(80,"div",11),n.Vb(81,"label",12),n.Lc(82,"Start Date"),n.Vb(83,"span",13),n.Lc(84,"*"),n.Ub(),n.Ub(),n.Vb(85,"p-calendar",33),n.dc("onSelect",(function(){return e.onStartDateChange()})),n.Ub(),n.Jc(86,$t,2,1,"div",15),n.Ub(),n.Vb(87,"div",11),n.Vb(88,"label",12),n.Lc(89,"Closing Date"),n.Ub(),n.Qb(90,"p-calendar",34),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(91,"div",6),n.Vb(92,"div",7),n.Qb(93,"i",8),n.Lc(94,"Potential Info "),n.Ub(),n.Vb(95,"div",9),n.Vb(96,"div",10),n.Vb(97,"div",11),n.Vb(98,"label",12),n.Lc(99,"Potential Amount"),n.Vb(100,"span",13),n.Lc(101,"*"),n.Ub(),n.Ub(),n.Qb(102,"input",35),n.Jc(103,Yt,2,1,"div",15),n.Ub(),n.Vb(104,"div",11),n.Vb(105,"label",12),n.Lc(106,"Level of Interest"),n.Ub(),n.Vb(107,"select",36),n.Vb(108,"option",19),n.Lc(109,"--SELECT--"),n.Ub(),n.Jc(110,Ht,2,2,"option",20),n.Ub(),n.Jc(111,Zt,2,1,"div",15),n.Ub(),n.Vb(112,"div",11),n.Vb(113,"label",12),n.Lc(114,"Industry"),n.Vb(115,"span",13),n.Lc(116,"*"),n.Ub(),n.Ub(),n.Vb(117,"div",17),n.Qb(118,"ng-select",37),n.Vb(119,"span"),n.Vb(120,"a",21),n.dc("click",(function(){return e.popupExternalService.showAddPopup("industry")})),n.Qb(121,"i",22),n.Ub(),n.Ub(),n.Ub(),n.Jc(122,Xt,2,1,"div",15),n.Ub(),n.Vb(123,"div",11),n.Vb(124,"label",12),n.Lc(125,"Information Source"),n.Vb(126,"span",13),n.Lc(127,"*"),n.Ub(),n.Ub(),n.Vb(128,"div",17),n.Qb(129,"ng-select",38),n.Vb(130,"span"),n.Vb(131,"a",21),n.dc("click",(function(){return e.popupExternalService.showAddPopup("info-source")})),n.Qb(132,"i",22),n.Ub(),n.Ub(),n.Ub(),n.Jc(133,te,2,1,"div",15),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(134,"div",6),n.Vb(135,"div",7),n.Qb(136,"i",8),n.Lc(137,"Stages Info "),n.Ub(),n.Vb(138,"div",39),n.Vb(139,"div",40),n.Vb(140,"table",41),n.Vb(141,"thead"),n.Vb(142,"tr"),n.Vb(143,"th",42),n.Lc(144,"Action"),n.Ub(),n.Vb(145,"th",43),n.Lc(146,"Start Date"),n.Vb(147,"span",13),n.Lc(148,"*"),n.Ub(),n.Ub(),n.Vb(149,"th",43),n.Lc(150,"Closing Date"),n.Vb(151,"span",13),n.Lc(152,"*"),n.Ub(),n.Ub(),n.Vb(153,"th",43),n.Lc(154,"Sales Employee"),n.Ub(),n.Vb(155,"th",42),n.Lc(156,"Stage"),n.Vb(157,"span",13),n.Lc(158,"*"),n.Ub(),n.Ub(),n.Vb(159,"th",43),n.Lc(160,"Stage Percentage"),n.Vb(161,"span",13),n.Lc(162,"*"),n.Ub(),n.Ub(),n.Vb(163,"th",42),n.Lc(164,"Activity No"),n.Ub(),n.Vb(165,"th",43),n.Lc(166,"Document Type"),n.Ub(),n.Vb(167,"th",44),n.Lc(168,"Document No"),n.Ub(),n.Ub(),n.Ub(),n.Vb(169,"tbody",45),n.Jc(170,de,35,26,"tr",46),n.Ub(),n.Vb(171,"tfoot"),n.Vb(172,"tr"),n.Vb(173,"td",47),n.Vb(174,"button",48),n.dc("click",(function(){return e.addStageFields()})),n.Qb(175,"i",22),n.Vb(176,"span"),n.Lc(177,"Add Stage"),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(178,"div",6),n.Vb(179,"div",7),n.Qb(180,"i",8),n.Lc(181,"Competitor "),n.Ub(),n.Vb(182,"div",9),n.Vb(183,"div",10),n.Vb(184,"div",11),n.Vb(185,"label",12),n.Lc(186,"Competitor"),n.Ub(),n.Vb(187,"div",17),n.Vb(188,"ng-select",49),n.dc("change",(function(t){return e.setThreatLevel(t.id)})),n.Ub(),n.Vb(189,"span"),n.Vb(190,"a",21),n.dc("click",(function(){return e.popupExternalService.showAddPopup("competitor")})),n.Qb(191,"i",22),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(192,"div",11),n.Vb(193,"label",12),n.Lc(194,"Threat Level"),n.Ub(),n.Qb(195,"input",50),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(196,"div",6),n.Vb(197,"div",7),n.Qb(198,"i",8),n.Lc(199,"Summary "),n.Ub(),n.Vb(200,"div",9),n.Vb(201,"div",10),n.Vb(202,"div",11),n.Vb(203,"label",12),n.Lc(204,"Status"),n.Vb(205,"span",13),n.Lc(206,"*"),n.Ub(),n.Ub(),n.Vb(207,"select",51),n.dc("change",(function(){return e.onStatusChange()})),n.Jc(208,le,2,2,"option",20),n.Ub(),n.Jc(209,me,2,1,"div",15),n.Ub(),n.Vb(210,"div",11),n.Vb(211,"label",12),n.Lc(212,"Reason"),n.Ub(),n.Vb(213,"div",17),n.Qb(214,"ng-select",52),n.Vb(215,"span"),n.Vb(216,"a",21),n.dc("click",(function(){return e.popupExternalService.showAddPopup("reason")})),n.Qb(217,"i",22),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Vb(218,"div",11),n.Vb(219,"label",12),n.Lc(220,"Remarks"),n.Ub(),n.Qb(221,"textarea",53),n.Ub(),n.Ub(),n.Ub(),n.Ub(),n.Qb(222,"app-udf-viewer",54),n.Vb(223,"app-attachments",55),n.dc("doSuccess",(function(){return e.redirectToList()})),n.Ub(),n.Vb(224,"div",56),n.Jc(225,pe,4,0,"button",57),n.Jc(226,he,4,0,"button",58),n.Jc(227,ge,4,0,"button",57),n.Jc(228,ye,4,0,"button",59),n.Ub(),n.Jc(229,Le,7,3,"div",60),n.Jc(230,Ce,7,0,"div",60),n.Ub()),2&t&&(n.Cb(4),n.oc("ngIf",!e.inputEditId),n.Cb(1),n.oc("ngIf",e.inputEditId),n.Cb(6),n.oc("formGroup",e.myForm1),n.Cb(13),n.oc("ngIf",e.myFormErrors1.opportunityNo),n.Cb(7),n.oc("ngIf",e.myFormErrors1.opportunityName),n.Cb(10),n.oc("ngForOf",e.opportunityTypeList),n.Cb(4),n.oc("ngIf",e.myFormErrors1.opportunityTypeId),n.Cb(7),n.oc("items",e.businessPartnerList)("multiple",!1),n.Cb(3),n.oc("ngIf",!e.bizRefreshFlag),n.Cb(1),n.oc("ngIf",e.bizRefreshFlag),n.Cb(1),n.oc("ngIf",e.myForm1Data.businessPartnerId),n.Cb(1),n.oc("ngIf",e.myFormErrors1.businessPartnerId),n.Cb(6),n.oc("items",e.bpContactList)("multiple",!1),n.Cb(2),n.oc("ngIf",e.myFormErrors1.bpContactsId),n.Cb(4),n.oc("ngIf",e.storageService.get("distRulesMode")),n.Cb(1),n.oc("items",e.distributionList)("multiple",!0),n.Cb(1),n.oc("ngIf",e.myFormErrors1.distributionRulesId),n.Cb(5),n.oc("items",e.salesEmployeeList)("multiple",!1),n.Cb(2),n.oc("ngIf",e.myForm1Data.empId),n.Cb(6),n.oc("monthNavigator",!0)("yearNavigator",!0)("yearRange",e.appConstants.PICKER_YEAR_RANGE)("dateFormat",e.appConstants.PICKER_DATE_FORMAT),n.Cb(1),n.oc("ngIf",e.myFormErrors1.startDate),n.Cb(4),n.oc("monthNavigator",!0)("yearNavigator",!0)("yearRange",e.appConstants.PICKER_YEAR_RANGE)("dateFormat",e.appConstants.PICKER_DATE_FORMAT)("minDate",e.myForm1Data.startDate),n.Cb(13),n.oc("ngIf",e.myFormErrors1.potentialAmount),n.Cb(7),n.oc("ngForOf",e.levelOfInterestList),n.Cb(1),n.oc("ngIf",e.myFormErrors1.levelOfInterestId),n.Cb(7),n.oc("items",e.industryList)("multiple",!1),n.Cb(4),n.oc("ngIf",e.myFormErrors1.industryId),n.Cb(7),n.oc("items",e.infoSourceList)("multiple",!1),n.Cb(4),n.oc("ngIf",e.myFormErrors1.informationSourceId),n.Cb(37),n.oc("ngForOf",e.myForm1.controls.stageListArray.controls),n.Cb(18),n.oc("items",e.competitorList)("multiple",!1),n.Cb(7),n.oc("value",e.threatLevelName),n.Cb(13),n.oc("ngForOf",e.statusList),n.Cb(1),n.oc("ngIf",e.myFormErrors1.opportunityStatus),n.Cb(5),n.oc("items",e.reasonList)("multiple",!1),n.Cb(8),n.oc("type",e.branchUtilsService.screenAttributes.opportunity.backendKey),n.Cb(1),n.oc("type",e.branchUtilsService.screenAttributes.opportunity.backendKey),n.Cb(2),n.oc("ngIf",e.screenAcl.add&&!e.inputEditId),n.Cb(1),n.oc("ngIf",!e.inputEditId),n.Cb(1),n.oc("ngIf",e.screenAcl.update&&e.inputEditId&&"1"===e.editStatusId),n.Cb(1),n.oc("ngIf",e.inputEditId),n.Cb(1),n.oc("ngIf",e.inputEditId),n.Cb(1),n.oc("ngIf",!e.inputEditId&&!e.screenAcl.add))},directives:[c.m,u.n,u.i,u.b,u.m,u.g,u.t,u.p,u.v,c.l,k.a,k.c,b.a,u.q,u.d,R.a,A.a,s.g,m.a,u.j,s.e],styles:[""]}),t})();const Ie=s.h.forChild([{path:"activity-list",component:E},{path:"activity-add",component:yt},{path:"activity-edit/:id",component:yt},{path:"oppurtunity-list",component:At},{path:"oppurtunity-add",component:Se},{path:"oppurtunity-edit/:id",component:Se}]);var Ue=i("o+NB"),Ve=i("7zUj"),De=i("N5hj"),Fe=i("dJ0z");let Ne=(()=>{class t{}return t.\u0275mod=n.Nb({type:t}),t.\u0275inj=n.Mb({factory:function(e){return new(e||t)},imports:[[Ie,Ue.BranchModule,Ve.a,De.a,Fe.a]]}),t})()}}]);